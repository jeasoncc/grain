# 搜索和替换功能使用指南

## 功能概述

Novel Editor 现在提供了两种强大的搜索功能：

1. **当前文件搜索替换** - 在编辑器中搜索和替换文本
2. **全局搜索** - 跨项目、章节、场景、角色和世界观的全文搜索

---

## 1. 当前文件搜索替换

### 快捷键

- **打开搜索**: `Ctrl+F` (Windows/Linux) 或 `Cmd+F` (macOS)
- **打开替换**: `Ctrl+H` (Windows/Linux) 或 `Cmd+H` (macOS)
- **关闭**: `Esc`

### 功能特性

#### 基本搜索
- 输入搜索词后自动高亮所有匹配项
- 显示匹配数量和当前位置（如：1/5）
- 使用 `↑` `↓` 按钮或 `Enter`/`Shift+Enter` 在匹配项间导航

#### 搜索选项

1. **区分大小写** (Case Sensitive)
   - 开启后，"Hello" 和 "hello" 将被视为不同的词

2. **全字匹配** (Whole Word)
   - 开启后，搜索 "cat" 不会匹配 "category"
   - 只匹配完整的单词

3. **正则表达式** (Regex)
   - 支持使用正则表达式进行高级搜索
   - 例如：`\d+` 匹配所有数字

#### 替换功能

- **替换当前**: 替换当前选中的匹配项，然后自动跳到下一个
- **全部替换**: 一次性替换所有匹配项

### 使用示例

#### 示例 1: 简单替换
```
搜索: "主角"
替换为: "李明"
操作: 点击"全部替换"
```

#### 示例 2: 区分大小写
```
搜索: "Hello"
选项: ✓ 区分大小写
结果: 只匹配 "Hello"，不匹配 "hello"
```

#### 示例 3: 正则表达式
```
搜索: "\d{4}年"
选项: ✓ 正则表达式
结果: 匹配 "2024年"、"1999年" 等
```

---

## 2. 全局搜索

### 快捷键

- **打开全局搜索**: `Ctrl+Shift+F` (Windows/Linux) 或 `Cmd+Shift+F` (macOS)

### 功能特性

#### 搜索范围
全局搜索会在以下内容中查找：
- 📄 **场景** - 所有场景的标题和内容
- 👤 **角色** - 角色名称、别名、身份、设定和经历
- 🌍 **世界观** - 世界观条目的名称、摘要和标签

#### 搜索结果
- 显示匹配项的类型（场景/角色/世界观）
- 显示所属项目和章节
- 高亮显示匹配的关键词
- 显示匹配文本的上下文片段

#### 键盘导航
- `↑` `↓` - 在结果间导航
- `Enter` - 打开选中的结果
- `Esc` - 关闭搜索对话框

### 使用示例

#### 示例 1: 查找角色
```
搜索: "张三"
结果: 显示所有提到"张三"的场景、角色设定等
点击结果: 自动跳转到对应页面
```

#### 示例 2: 查找情节
```
搜索: "决战"
结果: 显示所有包含"决战"的场景和章节
```

---

## 技术实现

### 搜索引擎
- 使用 **Lunr.js** 构建全文搜索索引
- 支持中文分词
- 相关性评分排序

### 性能优化
- 防抖搜索（300ms）避免频繁查询
- 简单搜索模式用于实时搜索
- 索引缓存提高搜索速度

### 数据存储
- 使用 Dexie.js (IndexedDB) 存储数据
- 支持离线搜索
- 自动索引更新

---

## 快捷键总览

| 功能 | Windows/Linux | macOS |
|------|---------------|-------|
| 当前文件搜索 | `Ctrl+F` | `Cmd+F` |
| 当前文件替换 | `Ctrl+H` | `Cmd+H` |
| 全局搜索 | `Ctrl+Shift+F` | `Cmd+Shift+F` |
| 下一个匹配 | `Enter` | `Enter` |
| 上一个匹配 | `Shift+Enter` | `Shift+Enter` |
| 关闭对话框 | `Esc` | `Esc` |

---

## 常见问题

### Q: 搜索速度慢怎么办？
A: 首次搜索时会构建索引，可能需要几秒钟。后续搜索会很快。

### Q: 如何搜索特殊字符？
A: 在正则表达式模式下，需要转义特殊字符。或者关闭正则表达式选项。

### Q: 替换后能撤销吗？
A: 可以使用编辑器的撤销功能 (`Ctrl+Z` / `Cmd+Z`)。

### Q: 全局搜索能搜索已删除的内容吗？
A: 不能。全局搜索只搜索当前存在的数据。

---

## 未来计划

- [ ] 支持搜索历史记录
- [ ] 支持保存常用搜索
- [ ] 支持高级过滤（按日期、标签等）
- [ ] 支持搜索结果导出
- [ ] 支持跨文件批量替换

---

## 反馈和建议

如果您有任何问题或建议，欢迎在 GitHub 上提交 Issue。

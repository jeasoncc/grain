# ç®€åŒ–æµ‹è¯•æŒ‡å—

## æ¨èæ–¹æ¡ˆï¼šç›´æ¥æ„å»ºæµ‹è¯•

ç”±äº AUR åŒ…æ„å»ºæ¶‰åŠå¤æ‚çš„è·¯å¾„é—®é¢˜ï¼Œ**æ¨èä½¿ç”¨ç›´æ¥æ„å»ºæ–¹å¼æµ‹è¯•**ã€‚

### ä¸€é”®æµ‹è¯•

```bash
./scripts/test-local-build.sh
```

è¿™ä¸ªè„šæœ¬ä¼šï¼š
1. âœ… æ£€æŸ¥ä¾èµ–ï¼ˆbun, rust, cargoï¼‰
2. âœ… å®‰è£… npm ä¾èµ–
3. âœ… æ„å»ºå‰ç«¯
4. âœ… æ„å»º Tauri åº”ç”¨
5. âœ… ç”Ÿæˆ DEB å’Œ RPM åŒ…
6. âœ… å¯é€‰ï¼šå®‰è£…æµ‹è¯•

### é¢„æœŸè¾“å‡º

```
ğŸ§ª æœ¬åœ°æ„å»ºæµ‹è¯•ï¼ˆä¸ä½¿ç”¨ PKGBUILDï¼‰
è¿™å°†ç›´æ¥æ„å»ºåº”ç”¨ï¼Œä¸æ‰“åŒ…æˆ AUR åŒ…

ğŸ“¦ æ£€æŸ¥ä¾èµ–...
âœ… ä¾èµ–æ£€æŸ¥é€šè¿‡

ğŸ§¹ æ¸…ç†ä¹‹å‰çš„æ„å»º...
âœ… æ¸…ç†å®Œæˆ

ğŸ“¦ å®‰è£…ä¾èµ–...
âœ… ä¾èµ–å®‰è£…å®Œæˆ

ğŸ”¨ æ„å»ºå‰ç«¯...
âœ… å‰ç«¯æ„å»ºå®Œæˆ

ğŸš€ æ„å»º Tauri åº”ç”¨...
è¿™å¯èƒ½éœ€è¦å‡ åˆ†é’Ÿ...

âœ… æ„å»ºæˆåŠŸï¼

ğŸ“¦ ç”Ÿæˆçš„åŒ…ï¼š

DEB åŒ…ï¼š
-rw-r--r-- 1 user user 45M novel-editor_0.1.0_amd64.deb

RPM åŒ…ï¼š
-rw-r--r-- 1 user user 46M novel-editor-0.1.0-1.x86_64.rpm

äºŒè¿›åˆ¶æ–‡ä»¶ï¼š
-rwxr-xr-x 1 user user 42M novel-editor

æ˜¯å¦å®‰è£… DEB åŒ…æµ‹è¯•ï¼Ÿ(y/N)
```

### æµ‹è¯•å®‰è£…

#### Arch Linux
```bash
# è™½ç„¶ç”Ÿæˆçš„æ˜¯ DEB åŒ…ï¼Œä½†å¯ä»¥æå–äºŒè¿›åˆ¶æ–‡ä»¶æµ‹è¯•
./apps/desktop/src-tauri/target/release/novel-editor
```

#### Ubuntu/Debian
```bash
sudo dpkg -i apps/desktop/src-tauri/target/release/bundle/deb/*.deb
novel-editor
```

#### Fedora/RHEL
```bash
sudo rpm -i apps/desktop/src-tauri/target/release/bundle/rpm/*.rpm
novel-editor
```

### éªŒè¯åŠŸèƒ½

è¿è¡Œåº”ç”¨åï¼Œæµ‹è¯•ï¼š
- [ ] åº”ç”¨å¯åŠ¨æ­£å¸¸
- [ ] å¯ä»¥åˆ›å»ºé¡¹ç›®
- [ ] å¯ä»¥åˆ›å»ºç« èŠ‚
- [ ] ç¼–è¾‘å™¨å¯ä»¥è¾“å…¥
- [ ] å¯ä»¥ä¿å­˜å†…å®¹
- [ ] æœç´¢åŠŸèƒ½æ­£å¸¸
- [ ] å¯ä»¥å¯¼å‡ºæ–‡ä»¶

### æ¸…ç†

```bash
# å¸è½½ï¼ˆUbuntu/Debianï¼‰
sudo dpkg -r novel-editor

# å¸è½½ï¼ˆFedora/RHELï¼‰
sudo rpm -e novel-editor

# æ¸…ç†æ„å»ºæ–‡ä»¶
rm -rf apps/desktop/dist
rm -rf apps/desktop/src-tauri/target
```

## AUR åŒ…æµ‹è¯•ï¼ˆå¯é€‰ï¼‰

å¦‚æœä½ ç¡®å®éœ€è¦æµ‹è¯• AUR åŒ…ï¼Œå»ºè®®ï¼š

### æ–¹æ¡ˆ 1ï¼šç­‰å¾… GitHub Release

1. å…ˆåˆ›å»º GitHub Release
2. ä½¿ç”¨æ­£å¼çš„ PKGBUILDï¼ˆä» GitHub ä¸‹è½½æºä»£ç ï¼‰
3. åœ¨ä¸´æ—¶ç›®å½•æµ‹è¯•

```bash
# åˆ›å»ºæµ‹è¯•ç›®å½•
mkdir -p /tmp/aur-test
cd /tmp/aur-test

# å¤åˆ¶ PKGBUILDï¼ˆæ­£å¼ç‰ˆï¼Œä¸æ˜¯ .localï¼‰
cp /path/to/novel-editor/aur/PKGBUILD .
cp /path/to/novel-editor/aur/novel-editor.desktop .

# ä¿®æ”¹ PKGBUILDï¼Œå°† sha256sums æ”¹ä¸º 'SKIP'
sed -i "s/sha256sums=.*/sha256sums=('SKIP')/" PKGBUILD

# æ„å»º
makepkg -sf
```

### æ–¹æ¡ˆ 2ï¼šä½¿ç”¨ Docker

åˆ›å»ºä¸€ä¸ª Arch Linux å®¹å™¨æ¥æµ‹è¯•ï¼š

```bash
# å¯åŠ¨ Arch Linux å®¹å™¨
docker run -it --rm -v $(pwd):/workspace archlinux:latest bash

# åœ¨å®¹å™¨ä¸­
cd /workspace
pacman -Syu --noconfirm
pacman -S --noconfirm base-devel git rust cargo nodejs patchelf webkit2gtk gtk3 libappindicator-gtk3

# å®‰è£… bun
curl -fsSL https://bun.sh/install | bash
source ~/.bashrc

# æµ‹è¯•æ„å»º
./scripts/test-local-build.sh
```

## å¸¸è§é—®é¢˜

### Q: ä¸ºä»€ä¹ˆä¸ç›´æ¥æµ‹è¯• AUR åŒ…ï¼Ÿ

A: AUR åŒ…æ„å»ºéœ€è¦ä» GitHub ä¸‹è½½æºä»£ç ï¼Œä½†ä½ è¿˜æ²¡æœ‰åˆ›å»º Releaseã€‚æœ¬åœ°æµ‹è¯• PKGBUILD æ¶‰åŠå¤æ‚çš„è·¯å¾„å¤„ç†ã€‚

### Q: ç›´æ¥æ„å»ºå’Œ AUR åŒ…æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ

A: 
- **ç›´æ¥æ„å»º**ï¼šåœ¨å½“å‰ç›®å½•æ„å»ºï¼Œé€Ÿåº¦å¿«ï¼Œé€‚åˆå¼€å‘æµ‹è¯•
- **AUR åŒ…**ï¼šä» GitHub ä¸‹è½½ï¼Œæ¨¡æ‹Ÿç”¨æˆ·å®‰è£…ï¼Œé€‚åˆå‘å¸ƒå‰éªŒè¯

### Q: æˆ‘å¿…é¡»æµ‹è¯• AUR åŒ…å—ï¼Ÿ

A: ä¸æ˜¯å¿…é¡»çš„ã€‚å¦‚æœç›´æ¥æ„å»ºæµ‹è¯•é€šè¿‡ï¼ŒAUR åŒ…é€šå¸¸ä¹Ÿæ²¡é—®é¢˜ã€‚å¯ä»¥åœ¨é¦–æ¬¡å‘å¸ƒåï¼Œè®©ç”¨æˆ·åé¦ˆé—®é¢˜ã€‚

### Q: æ„å»ºå¤±è´¥æ€ä¹ˆåŠï¼Ÿ

A: æŸ¥çœ‹é”™è¯¯ä¿¡æ¯ï¼Œå¸¸è§é—®é¢˜ï¼š
- ç¼ºå°‘ä¾èµ–ï¼šå®‰è£…ç›¸åº”çš„åŒ…
- Bun æœªå®‰è£…ï¼š`curl -fsSL https://bun.sh/install | bash`
- Rust æœªå®‰è£…ï¼š`curl --proto '=https' --tlsv1.2 -sSf https://sh.rustup.rs | sh`
- ç£ç›˜ç©ºé—´ä¸è¶³ï¼šæ¸…ç†ç¼“å­˜æˆ–å¢åŠ ç©ºé—´

## æ¨èæµç¨‹

1. âœ… è¿è¡Œ `./scripts/test-local-build.sh`
2. âœ… æµ‹è¯•åº”ç”¨åŠŸèƒ½
3. âœ… å¦‚æœä¸€åˆ‡æ­£å¸¸ï¼Œå‡†å¤‡å‘å¸ƒ
4. âœ… åˆ›å»º GitHub Release
5. âœ… å‘å¸ƒåˆ° AUR
6. âœ… è®©ç”¨æˆ·æµ‹è¯• AUR åŒ…

è¿™æ ·å¯ä»¥èŠ‚çœæ—¶é—´ï¼Œé¿å…å¤æ‚çš„æœ¬åœ° AUR åŒ…æµ‹è¯•ã€‚

## ä¸‹ä¸€æ­¥

å¦‚æœç›´æ¥æ„å»ºæµ‹è¯•é€šè¿‡ï¼š

```bash
# 1. æäº¤ä»£ç 
git add .
git commit -m "Release v0.1.0"
git push origin main

# 2. åˆ›å»º tag
git tag -a v0.1.0 -m "Release version 0.1.0"
git push origin v0.1.0

# 3. åœ¨ GitHub ä¸Šåˆ›å»º Release
# è®¿é—® https://github.com/jeasoncc/novel-editor/releases/new

# 4. å‘å¸ƒåˆ° AUR
./scripts/release-aur.sh 0.1.0
```

# Layout Restoration Spec

## ðŸ“‹ æ¦‚è¿°

æœ¬ spec å®šä¹‰äº†å°† Grain æ¡Œé¢åº”ç”¨çš„å¸ƒå±€ç³»ç»Ÿä»Žç®€åŒ–ç‰ˆæœ¬æ¢å¤åˆ°å®Œæ•´åŠŸèƒ½ç‰ˆæœ¬çš„éœ€æ±‚å’Œå®žçŽ°è®¡åˆ’ã€‚

## ðŸŽ¯ ç›®æ ‡

1. æ¢å¤ v0.1.163 é‡Œç¨‹ç¢‘ç‰ˆæœ¬ä¸­çš„æ‰€æœ‰å¸ƒå±€åŠŸèƒ½
2. éµå¾ªå½“å‰çš„å‡½æ•°å¼æž¶æž„æ¨¡å¼
3. ç¡®ä¿ä»£ç è´¨é‡å’Œå¯ç»´æŠ¤æ€§
4. æä¾›å®Œæ•´çš„æµ‹è¯•è¦†ç›–

## ðŸ“ æ–‡ä»¶ç»“æž„

```
.kiro/specs/layout-restoration/
â”œâ”€â”€ README.md           # æœ¬æ–‡ä»¶
â”œâ”€â”€ requirements.md     # éœ€æ±‚æ–‡æ¡£ï¼ˆå·²å®Œæˆï¼‰
â”œâ”€â”€ design.md          # è®¾è®¡æ–‡æ¡£ï¼ˆå¾…åˆ›å»ºï¼‰
â””â”€â”€ tasks.md           # ä»»åŠ¡æ¸…å•ï¼ˆå¾…åˆ›å»ºï¼‰
```

## ðŸ”„ å·¥ä½œæµç¨‹

### é˜¶æ®µ 1: éœ€æ±‚å®šä¹‰ âœ…

- [x] åˆ›å»º requirements.md
- [x] å®šä¹‰ 15 ä¸ªæ ¸å¿ƒéœ€æ±‚
- [x] ç¼–å†™ç”¨æˆ·æ•…äº‹å’ŒéªŒæ”¶æ ‡å‡†

### é˜¶æ®µ 2: è®¾è®¡æ–‡æ¡£ï¼ˆä¸‹ä¸€æ­¥ï¼‰

- [ ] åˆ›å»º design.md
- [ ] å®šä¹‰æž¶æž„è®¾è®¡
- [ ] å®šä¹‰ç»„ä»¶æŽ¥å£
- [ ] å®šä¹‰æ•°æ®æµ
- [ ] å®šä¹‰æ­£ç¡®æ€§å±žæ€§

### é˜¶æ®µ 3: ä»»åŠ¡åˆ†è§£

- [ ] åˆ›å»º tasks.md
- [ ] åˆ†è§£å®žçŽ°ä»»åŠ¡
- [ ] å®šä¹‰ä»»åŠ¡ä¾èµ–å…³ç³»
- [ ] ä¼°ç®—å·¥ä½œé‡

### é˜¶æ®µ 4: å®žçŽ°

- [ ] æŒ‰ä»»åŠ¡æ¸…å•é€æ­¥å®žçŽ°
- [ ] ç¼–å†™å•å…ƒæµ‹è¯•
- [ ] ç¼–å†™é›†æˆæµ‹è¯•
- [ ] ä»£ç å®¡æŸ¥

### é˜¶æ®µ 5: éªŒè¯

- [ ] åŠŸèƒ½æµ‹è¯•
- [ ] æ€§èƒ½æµ‹è¯•
- [ ] ç”¨æˆ·éªŒæ”¶æµ‹è¯•

## ðŸ—ï¸ æž¶æž„åŽŸåˆ™

æœ¬ spec ä¸¥æ ¼éµå¾ª Grain å‡½æ•°å¼æž¶æž„ï¼š

### ç›®å½•ç»“æž„

```
apps/desktop/src/
â”œâ”€â”€ views/              # UI ç»„ä»¶
â”‚   â”œâ”€â”€ app-layout/    # ä¸»å¸ƒå±€ç»„ä»¶
â”‚   â”œâ”€â”€ activity-bar/  # æ´»åŠ¨æ 
â”‚   â”œâ”€â”€ unified-sidebar/ # ç»Ÿä¸€ä¾§è¾¹æ 
â”‚   â”œâ”€â”€ command-palette/ # å‘½ä»¤é¢æ¿
â”‚   â”œâ”€â”€ global-search/ # å…¨å±€æœç´¢
â”‚   â”œâ”€â”€ buffer-switcher/ # æ ‡ç­¾åˆ‡æ¢å™¨
â”‚   â””â”€â”€ ...
â”œâ”€â”€ hooks/              # React hooks
â”‚   â”œâ”€â”€ use-layout.ts  # å¸ƒå±€ hook
â”‚   â””â”€â”€ ...
â”œâ”€â”€ state/              # çŠ¶æ€ç®¡ç†
â”‚   â”œâ”€â”€ layout.state.ts # å¸ƒå±€çŠ¶æ€
â”‚   â””â”€â”€ ...
â”œâ”€â”€ types/              # ç±»åž‹å®šä¹‰
â”‚   â”œâ”€â”€ layout.interface.ts
â”‚   â””â”€â”€ ...
â””â”€â”€ routes/             # è·¯ç”±
    â””â”€â”€ __root.tsx     # æ ¹è·¯ç”±
```

### ç»„ä»¶åˆ†ç¦»

- **è§†å›¾ç»„ä»¶** (`.view.fn.tsx`): çº¯å±•ç¤ºï¼Œé€šè¿‡ props æŽ¥æ”¶æ•°æ®
- **å®¹å™¨ç»„ä»¶** (`.container.fn.tsx`): æ•°æ®èŽ·å–å’ŒçŠ¶æ€ç®¡ç†
- **è·¯ç”±ç»„ä»¶**: ç¼–æŽ’å’Œç»„åˆ

### ä¾èµ–è§„åˆ™

```
views/  â†’  hooks/, types/
hooks/  â†’  flows/, state/, types/
flows/  â†’  pipes/, io/, state/, types/
pipes/  â†’  utils/, types/
io/     â†’  types/
state/  â†’  types/
utils/  â†’  types/
```

## ðŸ”§ æŠ€æœ¯æ ˆ

- **React 19**: UI æ¡†æž¶
- **TanStack Router**: è·¯ç”±ç®¡ç†
- **Zustand**: çŠ¶æ€ç®¡ç†
- **react-resizable-panels**: å¯è°ƒæ•´é¢æ¿
- **fp-ts**: å‡½æ•°å¼ç¼–ç¨‹
- **Zod**: æ•°æ®æ ¡éªŒ
- **Vitest**: æµ‹è¯•æ¡†æž¶

## ðŸ“Š å…³é”®æŒ‡æ ‡

### åŠŸèƒ½å®Œæ•´æ€§

- [ ] å¯æ‹–æ‹½è°ƒæ•´ä¾§è¾¹æ å®½åº¦
- [ ] å¸ƒå±€çŠ¶æ€æŒä¹…åŒ–
- [ ] å‘½ä»¤é¢æ¿ (Ctrl/Cmd+K)
- [ ] å…¨å±€æœç´¢ (Ctrl/Cmd+Shift+F)
- [ ] æ ‡ç­¾åˆ‡æ¢å™¨ (Ctrl+Tab)
- [ ] å¯¼å‡ºå¯¹è¯æ¡†ç®¡ç†
- [ ] å­—ä½“æ ·å¼æ³¨å…¥
- [ ] Toast é€šçŸ¥
- [ ] ä¸»é¢˜ç³»ç»Ÿ
- [ ] è‡ªåŠ¨å¤‡ä»½
- [ ] å¼€å‘å·¥å…·é›†æˆ

### ä»£ç è´¨é‡

- [ ] æ‰€æœ‰ç»„ä»¶éµå¾ªå‘½åè§„èŒƒ
- [ ] æ‰€æœ‰çº¯å‡½æ•°æœ‰å•å…ƒæµ‹è¯•
- [ ] æµ‹è¯•è¦†ç›–çŽ‡ > 80%
- [ ] æ—  TypeScript é”™è¯¯
- [ ] æ—  ESLint è­¦å‘Š
- [ ] é€šè¿‡æž¶æž„å®¡æŸ¥

### æ€§èƒ½æŒ‡æ ‡

- [ ] é¦–æ¬¡æ¸²æŸ“ < 100ms
- [ ] å¸ƒå±€è°ƒæ•´å“åº” < 16ms (60fps)
- [ ] å†…å­˜å ç”¨ < 50MB
- [ ] æ— å†…å­˜æ³„æ¼

## ðŸš€ å¿«é€Ÿå¼€å§‹

### æŸ¥çœ‹éœ€æ±‚

```bash
cat .kiro/specs/layout-restoration/requirements.md
```

### åˆ›å»ºè®¾è®¡æ–‡æ¡£

ä¸‹ä¸€æ­¥æ˜¯åˆ›å»ºè®¾è®¡æ–‡æ¡£ï¼Œå®šä¹‰å…·ä½“çš„å®žçŽ°æ–¹æ¡ˆã€‚

### æ‰§è¡Œä»»åŠ¡

ä»»åŠ¡åˆ›å»ºåŽï¼Œå¯ä»¥é€šè¿‡ Kiro çš„ä»»åŠ¡ç³»ç»Ÿé€æ­¥æ‰§è¡Œã€‚

## ðŸ“ ç›¸å…³æ–‡æ¡£

- [æž¶æž„æ–‡æ¡£](.kiro/steering/architecture.md)
- [ä»£ç è§„èŒƒ](.kiro/steering/code-standards.md)
- [å¸ƒå±€å®¡æŸ¥æ¸…å•](../../LAYOUT_AUDIT_CHECKLIST.md)

## ðŸ¤ è´¡çŒ®æŒ‡å—

1. æ‰€æœ‰ä»£ç å¿…é¡»é€šè¿‡æž¶æž„å®¡æŸ¥
2. æ‰€æœ‰çº¯å‡½æ•°å¿…é¡»æœ‰æµ‹è¯•
3. éµå¾ªå‘½åè§„èŒƒ
4. æäº¤å‰è¿è¡Œ `bun run lint` å’Œ `bun run test`

## ðŸ“ž è”ç³»æ–¹å¼

å¦‚æœ‰é—®é¢˜ï¼Œè¯·æŸ¥çœ‹ç›¸å…³æ–‡æ¡£æˆ–å’¨è¯¢å›¢é˜Ÿæˆå‘˜ã€‚

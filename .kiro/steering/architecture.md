# Grain å‡½æ•°å¼æ•°æ®æµæ¶æ„

æœ¬æ–‡æ¡£å®šä¹‰ Grain é¡¹ç›®çš„æ ¸å¿ƒæ¶æ„è®¾è®¡ï¼ŒåŸºäºå‡½æ•°å¼ç¼–ç¨‹ç†å¿µï¼Œå®ç°æ•°æ®çš„å•å‘æµåŠ¨ã€‚

## è®¾è®¡å“²å­¦

```
å¯¹è±¡ = çº¯æ•°æ®ï¼ˆInterface + Builder æ„å»ºï¼‰
æ“ä½œ = çº¯å‡½æ•°ï¼ˆå¯¹æ•°æ®è¿›è¡Œå˜æ¢ï¼‰
æµåŠ¨ = ç®¡é“ï¼ˆpipe è¿æ¥å‡½æ•°ï¼‰
```

- **æ•°æ®æ˜¯æ°´æµ**ï¼šæ•°æ®åƒæ°´ä¸€æ ·æµç»ç®¡é“ï¼Œæ¯ä¸ªç®¡é“èŠ‚ç‚¹æ˜¯ä¸€ä¸ªçº¯å‡½æ•°
- **å¯¹è±¡æ— æ–¹æ³•**ï¼šInterface å’Œ Builder åªå®šä¹‰æ•°æ®ç»“æ„ï¼Œä¸åŒ…å«è¡Œä¸º
- **å‡½æ•°æ˜¯ç®¡é“**ï¼šæ‰€æœ‰æ“ä½œéƒ½æ˜¯çº¯å‡½æ•°ï¼Œé€šè¿‡ pipe ç»„åˆ
- **ä¸å¯å˜æ€§**ï¼šæ•°æ®ä¸€æ—¦åˆ›å»ºå°±ä¸å¯ä¿®æ”¹ï¼Œæ›´æ–°äº§ç”Ÿæ–°å¯¹è±¡

## æ•°æ®æµæ¶æ„å›¾

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                              Grain å‡½æ•°å¼æ•°æ®æµæ¶æ„                                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

                                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                                    â”‚     å¤–éƒ¨ä¸–ç•Œ     â”‚
                                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                             â”‚
               â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
               â”‚                             â”‚                             â”‚
               â–¼                             â–¼                             â–¼
      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
      â”‚    UI è¡¨å•       â”‚          â”‚    API å“åº”     â”‚          â”‚   æ–‡ä»¶å¯¼å…¥      â”‚
      â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚                             â”‚                             â”‚
               â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                             â”‚
                                             â–¼
                          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                          â”‚           Zod Schema                â”‚
                          â”‚          (è¿è¡Œæ—¶æ ¡éªŒ)                â”‚
                          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                             â”‚
                               â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                               â”‚                           â”‚
                          âŒ æ ¡éªŒå¤±è´¥                   âœ… æ ¡éªŒé€šè¿‡
                               â”‚                           â”‚
                               â–¼                           â–¼
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚    é”™è¯¯å¤„ç†      â”‚         â”‚       Builder           â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â”‚   â†’ Object.freeze()     â”‚
                                                â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                                             â”‚
                                                             â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                           Pure Function Pipeline (çº¯å‡½æ•°ç®¡é“)                        â”‚
â”‚                                                                                    â”‚
â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”             â”‚
â”‚    â”‚  fn_1    â”‚â”€â”€â”€â”€â”€â–¶â”‚  fn_2    â”‚â”€â”€â”€â”€â”€â–¶â”‚  fn_3    â”‚â”€â”€â”€â”€â”€â–¶â”‚  fn_n    â”‚             â”‚
â”‚    â”‚ (è§£æ)   â”‚ pipe â”‚ (è½¬æ¢)   â”‚ pipe â”‚ (è®¡ç®—)   â”‚ pipe â”‚ (æ ¼å¼åŒ–) â”‚             â”‚
â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                                             â”‚
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚                                        â”‚                        â”‚
                    â–¼                                        â–¼                        â–¼
     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
     â”‚     DB Functions        â”‚          â”‚    Store Functions      â”‚    â”‚ Export Functions  â”‚
     â”‚      (æŒä¹…åŒ–)            â”‚          â”‚     (çŠ¶æ€)              â”‚    â”‚    (å¯¼å‡º)         â”‚
     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  â”‚                                    â”‚
                  â–¼                                    â–¼
     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
     â”‚       IndexedDB         â”‚â—€â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚     Zustand Store       â”‚
     â”‚        (Dexie)          â”‚  persist â”‚      (å†…å­˜çŠ¶æ€)          â”‚
     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                                       â”‚
                                                       â–¼
                              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                              â”‚                   React Hooks (å“åº”å¼ç»‘å®š)            â”‚
                              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                                         â”‚
                                                         â–¼
                              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                              â”‚                   Components (UI ç»„ä»¶)               â”‚
                              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                                         â”‚
                                                         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶ å›åˆ°é¡¶éƒ¨
```

## ä¾èµ–å…³ç³»å›¾

```
                              types/
                         (Interface + Builder + Schema)
                                 â”‚
                                 â”‚ è¢«æ‰€æœ‰å±‚ä¾èµ–
                                 â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚                        â”‚                        â”‚
        â–¼                        â–¼                        â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚  lib/  â”‚              â”‚  db/   â”‚              â”‚ stores/â”‚
    â”‚  (FP)  â”‚              â”‚(æŒä¹…åŒ–) â”‚              â”‚ (çŠ¶æ€) â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚                        â”‚                        â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                 â”‚
                                 â–¼
                          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                          â”‚    fn/     â”‚
                          â”‚  (çº¯å‡½æ•°)   â”‚
                          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                 â”‚
                                 â–¼
                          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                          â”‚  actions/  â”‚
                          â”‚ (ä¸šåŠ¡æ“ä½œ)  â”‚
                          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                 â”‚
                                 â–¼
                          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                          â”‚   hooks/   â”‚
                          â”‚ (Reactç»‘å®š) â”‚
                          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                 â”‚
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚                         â”‚
                    â–¼                         â–¼
             â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
             â”‚components/ â”‚            â”‚  routes/   â”‚
             â”‚   (UI)     â”‚            â”‚  (è·¯ç”±)    â”‚
             â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ä¾èµ–è§„åˆ™

| å±‚çº§ | å¯ä¾èµ– | è¯´æ˜ |
|------|--------|------|
| `types/` | æ—  | æœ€åº•å±‚ï¼Œçº¯æ•°æ®å®šä¹‰ |
| `lib/` | `types/` | å‡½æ•°å¼å·¥å…· |
| `db/` | `types/` | æŒä¹…åŒ–æ“ä½œ |
| `stores/` | `types/` | è¿è¡Œæ—¶çŠ¶æ€ |
| `fn/` | `types/`, `lib/`, `db/`, `stores/` | çº¯å‡½æ•°ç®¡é“ |
| `actions/` | `fn/`, `db/`, `stores/`, `types/` | ä¸šåŠ¡æ“ä½œ |
| `hooks/` | `actions/`, `fn/`, `stores/` | React ç»‘å®š |
| `components/` | `hooks/`, `types/` | UI ç»„ä»¶ |
| `routes/` | `hooks/`, `components/` | ä»…ç¼–æ’ï¼Œä¸å®ç°é€»è¾‘ |

## æ•°æ®ä¸‰å±‚å®ˆå«

| å±‚çº§ | èŒè´£ | æ—¶æœº |
|------|------|------|
| **Zod Schema** | è¿è¡Œæ—¶æ ¡éªŒå¤–éƒ¨æ•°æ® | æ•°æ®å…¥å£ |
| **Interface** | ç¼–è¯‘æ—¶ç±»å‹æ£€æŸ¥ | å¼€å‘æ—¶ |
| **Builder** | æ„å»ºçº¦æŸ + ä¸å¯å˜ | å¯¹è±¡åˆ›å»º |

## è§’è‰²å¯¹ç…§è¡¨

| æ¦‚å¿µ | è§’è‰² | ç‰¹ç‚¹ |
|-----|------|-----|
| **Interface** | æ°´çš„å½¢çŠ¶ | å®šä¹‰æ•°æ®é•¿ä»€ä¹ˆæ · |
| **Builder** | é€ æ°´çš„æ¨¡å…· | æ„å»ºç¬¦åˆå½¢çŠ¶çš„æ•°æ® |
| **Zod Schema** | å®ˆé—¨å‘˜ | è¿è¡Œæ—¶æ ¡éªŒæ•°æ®æœ‰æ•ˆæ€§ |
| **Function** | ç®¡é“ | çº¯å‡€ã€æ— å‰¯ä½œç”¨ã€å¯ç»„åˆ |
| **Pipe** | ç®¡é“è¿æ¥å™¨ | è®©æ•°æ®æµåŠ¨èµ·æ¥ |
| **Store** | æ°´æ±  | æš‚å­˜è¿è¡Œæ—¶çŠ¶æ€ |
| **DB** | æ°´åº“ | æŒä¹…åŒ–å­˜å‚¨ |
| **Hook** | æ°´é¾™å¤´ | è¿æ¥æ•°æ®å’Œ UI |
| **Component** | å–·æ³‰ | æ•°æ®çš„æœ€ç»ˆå±•ç° |


---

## Rust åç«¯ç»Ÿä¸€æ¶æ„

### è®¾è®¡å“²å­¦

```
æ ¸å¿ƒé€»è¾‘ = çº¯å‡½æ•°ï¼ˆrust-coreï¼‰
è¾¹ç•Œé€‚é… = å®ç”Ÿæˆï¼ˆé›¶æ‰‹å†™ï¼‰
ä¸¤ç«¯åˆä¸€ = å•ä¸€çœŸç›¸æº
```

- **çº¯å‡½æ•°æ ¸å¿ƒ**ï¼šæ‰€æœ‰ä¸šåŠ¡é€»è¾‘åœ¨ `rust-core` ä¸­ä»¥çº¯å‡½æ•°å½¢å¼å®šä¹‰
- **è¾¹ç•Œæ˜¯å™ªéŸ³**ï¼šHTTP/IPC åªæ˜¯æ•°æ®çš„å…¥å£å’Œå‡ºå£ï¼Œä¸åº”åŒ…å«é€»è¾‘
- **å®æ¶ˆé™¤é‡å¤**ï¼šé€šè¿‡å£°æ˜å¼å®è‡ªåŠ¨ç”Ÿæˆ Warp handlers å’Œ Tauri commands
- **ä¸€æ¬¡ä¿®æ”¹ï¼Œä¸¤ç«¯ç”Ÿæ•ˆ**ï¼šä¿®æ”¹ `rust-core` è‡ªåŠ¨å½±å“ Web API å’Œæ¡Œé¢åº”ç”¨

### Rust åç«¯æ•°æ®æµ

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                           Rust åç«¯ç»Ÿä¸€æ¶æ„                                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

                              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                              â”‚    å‰ç«¯è¯·æ±‚      â”‚
                              â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                       â”‚
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚                  â”‚                  â”‚
                    â–¼                  â–¼                  â–¼
           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
           â”‚  Web Browser  â”‚  â”‚ Tauri Desktop â”‚  â”‚  Mobile App   â”‚
           â”‚   (fetch)     â”‚  â”‚   (invoke)    â”‚  â”‚   (fetch)     â”‚
           â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
                   â”‚                  â”‚                  â”‚
                   â–¼                  â–¼                  â”‚
           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”‚
           â”‚  Warp Server  â”‚  â”‚ Tauri Runtime â”‚         â”‚
           â”‚  (HTTP è¾¹ç•Œ)   â”‚  â”‚  (IPC è¾¹ç•Œ)   â”‚         â”‚
           â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜         â”‚
                   â”‚                  â”‚                  â”‚
                   â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
                   â”‚    â”‚                           â”‚    â”‚
                   â–¼    â–¼                           â–¼    â–¼
           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
           â”‚                                                     â”‚
           â”‚              ğŸ¦€ rust-core (çº¯å‡½æ•°æ ¸å¿ƒ)                â”‚
           â”‚                                                     â”‚
           â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
           â”‚  â”‚              api/ (API ç«¯ç‚¹å®šä¹‰)              â”‚   â”‚
           â”‚  â”‚                                             â”‚   â”‚
           â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚   â”‚
           â”‚  â”‚  â”‚Workspaceâ”‚  â”‚  Node   â”‚  â”‚ Content â”‚     â”‚   â”‚
           â”‚  â”‚  â”‚Endpointsâ”‚  â”‚Endpointsâ”‚  â”‚Endpointsâ”‚     â”‚   â”‚
           â”‚  â”‚  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜     â”‚   â”‚
           â”‚  â”‚       â”‚            â”‚            â”‚           â”‚   â”‚
           â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
           â”‚          â”‚            â”‚            â”‚               â”‚
           â”‚          â–¼            â–¼            â–¼               â”‚
           â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
           â”‚  â”‚              fn/ (çº¯å‡½æ•°ç®¡é“)                 â”‚   â”‚
           â”‚  â”‚                                             â”‚   â”‚
           â”‚  â”‚  Input â”€â”€â–¶ validate â”€â”€â–¶ transform â”€â”€â–¶ Output â”‚   â”‚
           â”‚  â”‚                                             â”‚   â”‚
           â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
           â”‚                        â”‚                           â”‚
           â”‚                        â–¼                           â”‚
           â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
           â”‚  â”‚              db/ (æ•°æ®åº“æ“ä½œ)                 â”‚   â”‚
           â”‚  â”‚                                             â”‚   â”‚
           â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”        â”‚   â”‚
           â”‚  â”‚  â”‚ create â”‚  â”‚  read  â”‚  â”‚ update â”‚        â”‚   â”‚
           â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â”‚   â”‚
           â”‚  â”‚                                             â”‚   â”‚
           â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
           â”‚                        â”‚                           â”‚
           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                    â”‚
                                    â–¼
                          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                          â”‚     SQLite      â”‚
                          â”‚   (æŒä¹…åŒ–å­˜å‚¨)   â”‚
                          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### API ç«¯ç‚¹å®šä¹‰æ¨¡å¼

```rust
// rust-core/src/api/mod.rs

/// API ç«¯ç‚¹ trait - æ‰€æœ‰ç«¯ç‚¹çš„ç»Ÿä¸€æŠ½è±¡
pub trait ApiEndpoint: Send + Sync {
    /// è¾“å…¥ç±»å‹ï¼ˆè¯·æ±‚å‚æ•°ï¼‰
    type Input: DeserializeOwned + Send;
    /// è¾“å‡ºç±»å‹ï¼ˆå“åº”æ•°æ®ï¼‰
    type Output: Serialize + Send;
    
    /// æ‰§è¡Œç«¯ç‚¹é€»è¾‘ - çº¯å‡½æ•°ï¼Œåªä¾èµ– db å’Œ input
    fn execute(
        db: &DatabaseConnection,
        input: Self::Input,
    ) -> impl Future<Output = AppResult<Self::Output>> + Send;
}

// å…·ä½“ç«¯ç‚¹å®ç°
pub struct GetWorkspaces;
impl ApiEndpoint for GetWorkspaces {
    type Input = ();
    type Output = Vec<WorkspaceResponse>;
    
    async fn execute(db: &DatabaseConnection, _: ()) -> AppResult<Self::Output> {
        workspace_db_fn::find_all(db).await
    }
}
```

### å®ç”Ÿæˆè¾¹ç•Œä»£ç 

```rust
// rust-core/src/macros.rs

/// ç”Ÿæˆ Warp handlers
#[macro_export]
macro_rules! warp_routes {
    ($db:expr, $($endpoint:ty => $method:ident $path:literal),* $(,)?) => {{
        use warp::Filter;
        let db = std::sync::Arc::new($db);
        
        $(
            let route = warp::path!($path)
                .and(warp::$method())
                .and(with_db(db.clone()))
                .and_then(|db| async move {
                    <$endpoint>::execute(&db, ()).await
                        .map(|r| warp::reply::json(&r))
                        .map_err(|e| warp::reject::custom(e))
                });
        )*
        
        // ç»„åˆæ‰€æœ‰è·¯ç”±
        routes
    }};
}

/// ç”Ÿæˆ Tauri commands
#[macro_export]
macro_rules! tauri_commands {
    ($($endpoint:ty => $name:ident),* $(,)?) => {
        $(
            #[tauri::command]
            pub async fn $name(
                db: tauri::State<'_, DatabaseConnection>,
                input: <$endpoint as ApiEndpoint>::Input,
            ) -> Result<<$endpoint as ApiEndpoint>::Output, String> {
                <$endpoint>::execute(&db, input)
                    .await
                    .map_err(|e| e.to_string())
            }
        )*
    };
}
```

### æœ€ç»ˆä½¿ç”¨æ–¹å¼

```rust
// apps/api-rust/src/main.rs - Warp æœåŠ¡å™¨
#[tokio::main]
async fn main() {
    let db = rust_core::db::connect().await.unwrap();
    
    let routes = rust_core::warp_routes!(db,
        GetWorkspaces => get "api/workspaces",
        GetWorkspace => get "api/workspaces/{id}",
        CreateWorkspace => post "api/workspaces",
        // ... å…¶ä»–ç«¯ç‚¹
    );
    
    warp::serve(routes).run(([127, 0, 0, 1], 3030)).await;
}

// apps/desktop/src-tauri/src/lib.rs - Tauri åº”ç”¨
rust_core::tauri_commands!(
    GetWorkspaces => get_workspaces,
    GetWorkspace => get_workspace,
    CreateWorkspace => create_workspace,
    // ... å…¶ä»–ç«¯ç‚¹
);

fn main() {
    tauri::Builder::default()
        .invoke_handler(tauri::generate_handler![
            get_workspaces,
            get_workspace,
            create_workspace,
        ])
        .run(tauri::generate_context!())
        .unwrap();
}
```

### å±‚çº§èŒè´£

| å±‚çº§ | ä½ç½® | èŒè´£ |
|------|------|------|
| **api/** | `rust-core/src/api/` | API ç«¯ç‚¹å®šä¹‰ï¼Œå®ç° `ApiEndpoint` trait |
| **fn/** | `rust-core/src/fn/` | çº¯å‡½æ•°ç®¡é“ï¼Œä¸šåŠ¡é€»è¾‘è½¬æ¢ |
| **db/** | `rust-core/src/db/` | æ•°æ®åº“ CRUD æ“ä½œ |
| **types/** | `rust-core/src/types/` | ç±»å‹å®šä¹‰ï¼ˆRequest/Response/Entityï¼‰ |
| **macros/** | `rust-core/src/macros.rs` | å®å®šä¹‰ï¼Œç”Ÿæˆè¾¹ç•Œä»£ç  |

### äº‹åŠ¡æ”¯æŒ

```rust
// éœ€è¦äº‹åŠ¡çš„ç«¯ç‚¹
pub struct CreateNodeWithContent;
impl ApiEndpoint for CreateNodeWithContent {
    type Input = CreateNodeRequest;
    type Output = NodeResponse;
    
    async fn execute(db: &DatabaseConnection, input: Self::Input) -> AppResult<Self::Output> {
        // å¼€å¯äº‹åŠ¡
        let txn = db.begin().await?;
        
        // 1. åˆ›å»ºèŠ‚ç‚¹
        let node = node_db_fn::create(&txn, &input).await?;
        
        // 2. åˆ›å»ºå†…å®¹ï¼ˆå¦‚æœéœ€è¦ï¼‰
        if let Some(content) = input.initial_content {
            content_db_fn::create(&txn, &node.id, &content).await?;
        }
        
        // 3. æäº¤äº‹åŠ¡
        txn.commit().await?;
        
        Ok(node.into())
    }
}
```

### è§’è‰²å¯¹ç…§è¡¨ï¼ˆRust åç«¯ï¼‰

| æ¦‚å¿µ | è§’è‰² | ç‰¹ç‚¹ |
|-----|------|-----|
| **ApiEndpoint** | æ°´é—¸ | å®šä¹‰æ•°æ®å¦‚ä½•è¿›å‡ºç³»ç»Ÿ |
| **Input/Output** | æ°´çš„å½¢çŠ¶ | è¯·æ±‚å’Œå“åº”çš„ç±»å‹çº¦æŸ |
| **execute()** | æ°´å¤„ç†å‚ | çº¯å‡½æ•°ï¼Œå¤„ç†æ•°æ®æµ |
| **db/** | æ°´åº“ | æŒä¹…åŒ–å­˜å‚¨ |
| **fn/** | ç®¡é“ | æ•°æ®è½¬æ¢å’ŒéªŒè¯ |
| **å®** | åˆ†æµå™¨ | å°†æ°´æµå¯¼å‘ä¸åŒå‡ºå£ï¼ˆHTTP/IPCï¼‰ |
| **Warp/Tauri** | å‡ºæ°´å£ | è¾¹ç•Œé€‚é…ï¼Œä¸å«é€»è¾‘ |

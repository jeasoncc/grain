# Grain å‡½æ•°å¼æ•°æ®æµæ¶æ„

æœ¬æ–‡æ¡£å®šä¹‰ Grain é¡¹ç›®çš„æ ¸å¿ƒæ¶æ„è®¾è®¡ï¼ŒåŸºäºå‡½æ•°å¼ç¼–ç¨‹ç†å¿µï¼Œå®ç°æ•°æ®çš„å•å‘æµåŠ¨ã€‚

## è®¾è®¡å“²å­¦

```
å¯¹è±¡ = çº¯æ•°æ®ï¼ˆInterface + Builder æ„å»ºï¼‰
æ“ä½œ = çº¯å‡½æ•°ï¼ˆå¯¹æ•°æ®è¿›è¡Œå˜æ¢ï¼‰
æµåŠ¨ = ç®¡é“ï¼ˆpipe è¿æ¥å‡½æ•°ï¼‰
```

- **æ•°æ®æ˜¯æ°´æµ**ï¼šæ•°æ®åƒæ°´ä¸€æ ·æµç»ç®¡é“ï¼Œæ¯ä¸ªç®¡é“èŠ‚ç‚¹æ˜¯ä¸€ä¸ªçº¯å‡½æ•°
- **å¯¹è±¡æ— æ–¹æ³•**ï¼šInterface å’Œ Builder åªå®šä¹‰æ•°æ®ç»“æ„ï¼Œä¸åŒ…å«è¡Œä¸º
- **å‡½æ•°æ˜¯ç®¡é“**ï¼šæ‰€æœ‰æ“ä½œéƒ½æ˜¯çº¯å‡½æ•°ï¼Œé€šè¿‡ pipe ç»„åˆ
- **ä¸å¯å˜æ€§**ï¼šæ•°æ®ä¸€æ—¦åˆ›å»ºå°±ä¸å¯ä¿®æ”¹ï¼Œæ›´æ–°äº§ç”Ÿæ–°å¯¹è±¡

## æ•°æ®æµæ¶æ„å›¾ï¼ˆåŒæ­¥ï¼‰

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                              Grain å‡½æ•°å¼æ•°æ®æµæ¶æ„ï¼ˆåŒæ­¥ï¼‰                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

                                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                                    â”‚     å¤–éƒ¨ä¸–ç•Œ     â”‚
                                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                             â”‚
               â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
               â”‚                             â”‚                             â”‚
               â–¼                             â–¼                             â–¼
      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
      â”‚    UI è¡¨å•       â”‚          â”‚    API å“åº”     â”‚          â”‚   æ–‡ä»¶å¯¼å…¥      â”‚
      â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚                             â”‚                             â”‚
               â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                             â”‚
                                             â–¼
                          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                          â”‚           Zod Schema                â”‚
                          â”‚          (è¿è¡Œæ—¶æ ¡éªŒ)                â”‚
                          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                             â”‚
                               â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                               â”‚                           â”‚
                          âŒ æ ¡éªŒå¤±è´¥                   âœ… æ ¡éªŒé€šè¿‡
                               â”‚                           â”‚
                               â–¼                           â–¼
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚    é”™è¯¯å¤„ç†      â”‚         â”‚       Builder           â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â”‚   â†’ Object.freeze()     â”‚
                                                â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                                             â”‚
                                                             â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                           Pure Function Pipeline (çº¯å‡½æ•°ç®¡é“)                        â”‚
â”‚                                                                                    â”‚
â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”             â”‚
â”‚    â”‚  fn_1    â”‚â”€â”€â”€â”€â”€â–¶â”‚  fn_2    â”‚â”€â”€â”€â”€â”€â–¶â”‚  fn_3    â”‚â”€â”€â”€â”€â”€â–¶â”‚  fn_n    â”‚             â”‚
â”‚    â”‚ (è§£æ)   â”‚ pipe â”‚ (è½¬æ¢)   â”‚ pipe â”‚ (è®¡ç®—)   â”‚ pipe â”‚ (æ ¼å¼åŒ–) â”‚             â”‚
â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                                             â”‚
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚                                        â”‚                        â”‚
                    â–¼                                        â–¼                        â–¼
     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
     â”‚     DB Functions        â”‚          â”‚    Store Functions      â”‚    â”‚ Export Functions  â”‚
     â”‚      (æŒä¹…åŒ–)            â”‚          â”‚     (çŠ¶æ€)              â”‚    â”‚    (å¯¼å‡º)         â”‚
     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  â”‚                                    â”‚
                  â–¼                                    â–¼
     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
     â”‚       IndexedDB         â”‚â—€â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚     Zustand Store       â”‚
     â”‚        (Dexie)          â”‚  persist â”‚      (å†…å­˜çŠ¶æ€)          â”‚
     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                                       â”‚
                                                       â–¼
                              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                              â”‚                   React Hooks (å“åº”å¼ç»‘å®š)            â”‚
                              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                                         â”‚
                                                         â–¼
                              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                              â”‚                   Components (UI ç»„ä»¶)               â”‚
                              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                                         â”‚
                                                         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶ å›åˆ°é¡¶éƒ¨
```

---

## å‰ç«¯å¼‚æ­¥æ•°æ®æµæ¶æ„å›¾

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         Grain å‰ç«¯å¼‚æ­¥æ•°æ®æµæ¶æ„                                      â”‚
â”‚                      ï¼ˆä½¿ç”¨ fp-ts TaskEither å¤„ç†å¼‚æ­¥æ“ä½œï¼‰                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

                                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                                    â”‚   ç”¨æˆ·æ“ä½œè§¦å‘   â”‚
                                    â”‚  (ç‚¹å‡»/è¾“å…¥ç­‰)   â”‚
                                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                             â”‚
                                             â–¼
                          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                          â”‚           Action å±‚                 â”‚
                          â”‚      (actions/*.action.ts)          â”‚
                          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                             â”‚
                                             â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    TaskEither Pipeline (å¼‚æ­¥çº¯å‡½æ•°ç®¡é“)                              â”‚
â”‚                                                                                    â”‚
â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚    â”‚   TE.Do      â”‚â”€â”€â”€â–¶â”‚  TE.bind    â”‚â”€â”€â”€â–¶â”‚  TE.chain   â”‚â”€â”€â”€â–¶â”‚   TE.map    â”‚   â”‚
â”‚    â”‚  (å¼€å§‹ç®¡é“)   â”‚    â”‚ (ç»‘å®šå˜é‡)   â”‚    â”‚ (é“¾å¼è°ƒç”¨)   â”‚    â”‚  (è½¬æ¢ç»“æœ)  â”‚   â”‚
â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                                    â”‚
â”‚    ç‰¹ç‚¹ï¼š                                                                          â”‚
â”‚    - TaskEither<AppError, T> å°è£…å¼‚æ­¥æ“ä½œ                                          â”‚
â”‚    - Left = é”™è¯¯ï¼ŒRight = æˆåŠŸ                                                     â”‚
â”‚    - é”™è¯¯è‡ªåŠ¨ä¼ é€’ï¼Œæ— éœ€ try-catch                                                   â”‚
â”‚    - æƒ°æ€§æ±‚å€¼ï¼Œè°ƒç”¨æ—¶æ‰æ‰§è¡Œ                                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                             â”‚
               â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
               â”‚                             â”‚                             â”‚
               â–¼                             â–¼                             â–¼
      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
      â”‚  Rust Backend   â”‚          â”‚   Local Store   â”‚          â”‚   File System   â”‚
      â”‚  (Tauri/Warp)   â”‚          â”‚   (Zustand)     â”‚          â”‚   (å¯¼å‡º/å¯¼å…¥)    â”‚
      â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚                             â”‚                             â”‚
               â”‚ invoke/fetch                â”‚ setState                    â”‚ writeFile
               â”‚ (å¼‚æ­¥ IO)                   â”‚ (åŒæ­¥)                      â”‚ (å¼‚æ­¥ IO)
               â–¼                             â–¼                             â–¼
      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
      â”‚    SQLite       â”‚          â”‚  Memory State   â”‚          â”‚   Local Files   â”‚
      â”‚  (æŒä¹…åŒ–å­˜å‚¨)    â”‚          â”‚   (è¿è¡Œæ—¶çŠ¶æ€)   â”‚          â”‚   (æ–‡ä»¶ç³»ç»Ÿ)    â”‚
      â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚                             â”‚
               â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                             â”‚
                                             â–¼
                          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                          â”‚         æ‰§è¡Œ TaskEither             â”‚
                          â”‚    pipe(task, TE.fold(...))()       â”‚
                          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                             â”‚
                               â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                               â”‚                           â”‚
                          âŒ Left (é”™è¯¯)              âœ… Right (æˆåŠŸ)
                               â”‚                           â”‚
                               â–¼                           â–¼
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚   é”™è¯¯å¤„ç†       â”‚         â”‚    æ›´æ–° UI çŠ¶æ€         â”‚
                    â”‚  - Toast æç¤º   â”‚         â”‚  - Store æ›´æ–°           â”‚
                    â”‚  - æ—¥å¿—è®°å½•     â”‚         â”‚  - è§¦å‘é‡æ¸²æŸ“           â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                                             â”‚
                                                             â–¼
                              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                              â”‚                   React Hooks (å“åº”å¼ç»‘å®š)            â”‚
                              â”‚                                                     â”‚
                              â”‚  useQuery / useMutation / useStore                  â”‚
                              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                                         â”‚
                                                         â–¼
                              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                              â”‚                   Components (UI ç»„ä»¶)               â”‚
                              â”‚                                                     â”‚
                              â”‚  - Loading çŠ¶æ€                                     â”‚
                              â”‚  - Error çŠ¶æ€                                       â”‚
                              â”‚  - Success çŠ¶æ€                                     â”‚
                              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### å¼‚æ­¥ Action ç¤ºä¾‹

```typescript
// actions/node/create-node.action.ts
import { pipe } from "fp-ts/function";
import * as TE from "fp-ts/TaskEither";
import { AppError } from "@/lib/error.types";

// å¼‚æ­¥ Action è¿”å› TaskEither
export const createNode = (
  params: CreateNodeParams
): TE.TaskEither<AppError, Node> =>
  pipe(
    // 1. æ ¡éªŒè¾“å…¥ï¼ˆåŒæ­¥çº¯å‡½æ•°ï¼‰
    TE.fromEither(validateNodeParams(params)),
    
    // 2. è½¬æ¢ä¸ºè¯·æ±‚å¯¹è±¡ï¼ˆåŒæ­¥çº¯å‡½æ•°ï¼‰
    TE.map(validated => toCreateNodeRequest(validated)),
    
    // 3. è°ƒç”¨ Rust åç«¯ï¼ˆå¼‚æ­¥ IOï¼‰
    TE.chain(request => 
      TE.tryCatch(
        () => invoke<Node>("create_node", { request }),
        (error) => AppError.fromUnknown(error)
      )
    ),
    
    // 4. æ›´æ–°æœ¬åœ°çŠ¶æ€ï¼ˆå‰¯ä½œç”¨ï¼‰
    TE.tap(node => 
      TE.fromIO(() => useNodeStore.getState().addNode(node))
    ),
    
    // 5. è®°å½•æ—¥å¿—ï¼ˆå‰¯ä½œç”¨ï¼‰
    TE.tap(node => 
      TE.fromIO(() => logger.success(`[Node] åˆ›å»ºæˆåŠŸ: ${node.id}`))
    )
  );

// åœ¨ç»„ä»¶ä¸­ä½¿ç”¨
const handleCreate = async () => {
  const result = await pipe(
    createNode({ title: "æ–°èŠ‚ç‚¹", workspaceId }),
    TE.fold(
      (error) => T.of(showErrorToast(error.message)),
      (node) => T.of(showSuccessToast(`åˆ›å»ºæˆåŠŸ: ${node.title}`))
    )
  )();
};
```

### å¼‚æ­¥æ•°æ®æµç±»å‹ç­¾å

```typescript
// åŒæ­¥çº¯å‡½æ•°ï¼šInput â†’ Output
type SyncPureFn<A, B> = (a: A) => B;

// åŒæ­¥çº¯å‡½æ•°ï¼ˆå¯èƒ½å¤±è´¥ï¼‰ï¼šInput â†’ Either<Error, Output>
type SyncPureFnE<A, B> = (a: A) => E.Either<AppError, B>;

// å¼‚æ­¥çº¯å‡½æ•°ï¼šInput â†’ TaskEither<Error, Output>
type AsyncPureFn<A, B> = (a: A) => TE.TaskEither<AppError, B>;

// Action ç­¾åï¼ˆå¼‚æ­¥ï¼Œæœ‰å‰¯ä½œç”¨è¾¹ç•Œï¼‰
type Action<Params, Result> = (params: Params) => TE.TaskEither<AppError, Result>;
```

### å‰ç«¯å¼‚æ­¥æµç¨‹å¯¹ç…§è¡¨

| åŒæ­¥æµç¨‹ | å¼‚æ­¥æµç¨‹ | è¯´æ˜ |
|---------|---------|------|
| `pipe(a, fn1, fn2)` | `pipe(a, TE.map(fn1), TE.chain(fn2))` | å‡½æ•°ç»„åˆ |
| `Either<E, A>` | `TaskEither<E, A>` | é”™è¯¯å®¹å™¨ |
| `E.map` | `TE.map` | è½¬æ¢æˆåŠŸå€¼ |
| `E.chain` | `TE.chain` | é“¾å¼è°ƒç”¨ |
| `E.fold` | `TE.fold` | å¤„ç†ç»“æœ |
| ç«‹å³æ‰§è¡Œ | `()` è°ƒç”¨æ‰§è¡Œ | æƒ°æ€§æ±‚å€¼ |

### å¼‚æ­¥æ“ä½œåˆ†ç±»

| æ“ä½œç±»å‹ | è¿”å›ç±»å‹ | ç¤ºä¾‹ |
|---------|---------|------|
| åŒæ­¥çº¯å‡½æ•° | `A â†’ B` | `validateParams`, `transformNode` |
| åŒæ­¥å¯å¤±è´¥ | `A â†’ Either<E, B>` | `parseJson`, `validateSchema` |
| å¼‚æ­¥ IO | `A â†’ TaskEither<E, B>` | `invoke`, `fetch`, `readFile` |
| å‰¯ä½œç”¨ | `A â†’ IO<void>` | `setState`, `logger.info` |

## ä¾èµ–å…³ç³»å›¾

```
                              types/
                         (Interface + Builder + Schema)
                                 â”‚
                                 â”‚ è¢«æ‰€æœ‰å±‚ä¾èµ–
                                 â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚                        â”‚                        â”‚
        â–¼                        â–¼                        â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚  lib/  â”‚              â”‚  db/   â”‚              â”‚ stores/â”‚
    â”‚  (FP)  â”‚              â”‚(æŒä¹…åŒ–) â”‚              â”‚ (çŠ¶æ€) â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚                        â”‚                        â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                 â”‚
                                 â–¼
                          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                          â”‚    fn/     â”‚
                          â”‚  (çº¯å‡½æ•°)   â”‚
                          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                 â”‚
                                 â–¼
                          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                          â”‚  actions/  â”‚
                          â”‚ (ä¸šåŠ¡æ“ä½œ)  â”‚
                          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                 â”‚
                                 â–¼
                          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                          â”‚   hooks/   â”‚
                          â”‚ (Reactç»‘å®š) â”‚
                          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                 â”‚
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚                         â”‚
                    â–¼                         â–¼
             â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
             â”‚components/ â”‚            â”‚  routes/   â”‚
             â”‚   (UI)     â”‚            â”‚  (è·¯ç”±)    â”‚
             â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ä¾èµ–è§„åˆ™

| å±‚çº§ | å¯ä¾èµ– | è¯´æ˜ |
|------|--------|------|
| `types/` | æ—  | æœ€åº•å±‚ï¼Œçº¯æ•°æ®å®šä¹‰ |
| `lib/` | `types/` | å‡½æ•°å¼å·¥å…· |
| `db/` | `types/` | æŒä¹…åŒ–æ“ä½œ |
| `stores/` | `types/` | è¿è¡Œæ—¶çŠ¶æ€ |
| `fn/` | `types/`, `lib/`, `db/`, `stores/` | çº¯å‡½æ•°ç®¡é“ |
| `actions/` | `fn/`, `db/`, `stores/`, `types/` | ä¸šåŠ¡æ“ä½œ |
| `hooks/` | `actions/`, `fn/`, `stores/` | React ç»‘å®š |
| `components/` | `hooks/`, `types/` | UI ç»„ä»¶ |
| `routes/` | `hooks/`, `components/` | ä»…ç¼–æ’ï¼Œä¸å®ç°é€»è¾‘ |

## æ•°æ®ä¸‰å±‚å®ˆå«

| å±‚çº§ | èŒè´£ | æ—¶æœº |
|------|------|------|
| **Zod Schema** | è¿è¡Œæ—¶æ ¡éªŒå¤–éƒ¨æ•°æ® | æ•°æ®å…¥å£ |
| **Interface** | ç¼–è¯‘æ—¶ç±»å‹æ£€æŸ¥ | å¼€å‘æ—¶ |
| **Builder** | æ„å»ºçº¦æŸ + ä¸å¯å˜ | å¯¹è±¡åˆ›å»º |

## è§’è‰²å¯¹ç…§è¡¨

| æ¦‚å¿µ | è§’è‰² | ç‰¹ç‚¹ |
|-----|------|-----|
| **Interface** | æ°´çš„å½¢çŠ¶ | å®šä¹‰æ•°æ®é•¿ä»€ä¹ˆæ · |
| **Builder** | é€ æ°´çš„æ¨¡å…· | æ„å»ºç¬¦åˆå½¢çŠ¶çš„æ•°æ® |
| **Zod Schema** | å®ˆé—¨å‘˜ | è¿è¡Œæ—¶æ ¡éªŒæ•°æ®æœ‰æ•ˆæ€§ |
| **Function** | ç®¡é“ | çº¯å‡€ã€æ— å‰¯ä½œç”¨ã€å¯ç»„åˆ |
| **Pipe** | ç®¡é“è¿æ¥å™¨ | è®©æ•°æ®æµåŠ¨èµ·æ¥ |
| **Store** | æ°´æ±  | æš‚å­˜è¿è¡Œæ—¶çŠ¶æ€ |
| **DB** | æ°´åº“ | æŒä¹…åŒ–å­˜å‚¨ |
| **Hook** | æ°´é¾™å¤´ | è¿æ¥æ•°æ®å’Œ UI |
| **Component** | å–·æ³‰ | æ•°æ®çš„æœ€ç»ˆå±•ç° |


---

## Rust åç«¯ç»Ÿä¸€æ¶æ„

### è®¾è®¡å“²å­¦

```
æ ¸å¿ƒé€»è¾‘ = çº¯å‡½æ•°ï¼ˆrust-coreï¼‰
è¾¹ç•Œé€‚é… = å®ç”Ÿæˆï¼ˆé›¶æ‰‹å†™ï¼‰
ä¸¤ç«¯åˆä¸€ = å•ä¸€çœŸç›¸æº
```

- **çº¯å‡½æ•°æ ¸å¿ƒ**ï¼šæ‰€æœ‰ä¸šåŠ¡é€»è¾‘åœ¨ `rust-core` ä¸­ä»¥çº¯å‡½æ•°å½¢å¼å®šä¹‰
- **è¾¹ç•Œæ˜¯å™ªéŸ³**ï¼šHTTP/IPC åªæ˜¯æ•°æ®çš„å…¥å£å’Œå‡ºå£ï¼Œä¸åº”åŒ…å«é€»è¾‘
- **å®æ¶ˆé™¤é‡å¤**ï¼šé€šè¿‡å£°æ˜å¼å®è‡ªåŠ¨ç”Ÿæˆ Warp handlers å’Œ Tauri commands
- **ä¸€æ¬¡ä¿®æ”¹ï¼Œä¸¤ç«¯ç”Ÿæ•ˆ**ï¼šä¿®æ”¹ `rust-core` è‡ªåŠ¨å½±å“ Web API å’Œæ¡Œé¢åº”ç”¨

### Rust åç«¯æ•°æ®æµ

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                           Rust åç«¯ç»Ÿä¸€æ¶æ„                                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

                              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                              â”‚    å‰ç«¯è¯·æ±‚      â”‚
                              â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                       â”‚
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚                  â”‚                  â”‚
                    â–¼                  â–¼                  â–¼
           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
           â”‚  Web Browser  â”‚  â”‚ Tauri Desktop â”‚  â”‚  Mobile App   â”‚
           â”‚   (fetch)     â”‚  â”‚   (invoke)    â”‚  â”‚   (fetch)     â”‚
           â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
                   â”‚                  â”‚                  â”‚
                   â–¼                  â–¼                  â”‚
           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”‚
           â”‚  Warp Server  â”‚  â”‚ Tauri Runtime â”‚         â”‚
           â”‚  (HTTP è¾¹ç•Œ)   â”‚  â”‚  (IPC è¾¹ç•Œ)   â”‚         â”‚
           â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜         â”‚
                   â”‚                  â”‚                  â”‚
                   â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
                   â”‚    â”‚                           â”‚    â”‚
                   â–¼    â–¼                           â–¼    â–¼
           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
           â”‚                                                     â”‚
           â”‚              ğŸ¦€ rust-core (çº¯å‡½æ•°æ ¸å¿ƒ)                â”‚
           â”‚                                                     â”‚
           â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
           â”‚  â”‚              api/ (API ç«¯ç‚¹å®šä¹‰)              â”‚   â”‚
           â”‚  â”‚                                             â”‚   â”‚
           â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚   â”‚
           â”‚  â”‚  â”‚Workspaceâ”‚  â”‚  Node   â”‚  â”‚ Content â”‚     â”‚   â”‚
           â”‚  â”‚  â”‚Endpointsâ”‚  â”‚Endpointsâ”‚  â”‚Endpointsâ”‚     â”‚   â”‚
           â”‚  â”‚  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜     â”‚   â”‚
           â”‚  â”‚       â”‚            â”‚            â”‚           â”‚   â”‚
           â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
           â”‚          â”‚            â”‚            â”‚               â”‚
           â”‚          â–¼            â–¼            â–¼               â”‚
           â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
           â”‚  â”‚              fn/ (çº¯å‡½æ•°ç®¡é“)                 â”‚   â”‚
           â”‚  â”‚                                             â”‚   â”‚
           â”‚  â”‚  Input â”€â”€â–¶ validate â”€â”€â–¶ transform â”€â”€â–¶ Output â”‚   â”‚
           â”‚  â”‚                                             â”‚   â”‚
           â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
           â”‚                        â”‚                           â”‚
           â”‚                        â–¼                           â”‚
           â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
           â”‚  â”‚              db/ (æ•°æ®åº“æ“ä½œ)                 â”‚   â”‚
           â”‚  â”‚                                             â”‚   â”‚
           â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”        â”‚   â”‚
           â”‚  â”‚  â”‚ create â”‚  â”‚  read  â”‚  â”‚ update â”‚        â”‚   â”‚
           â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â”‚   â”‚
           â”‚  â”‚                                             â”‚   â”‚
           â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
           â”‚                        â”‚                           â”‚
           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                    â”‚
                                    â–¼
                          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                          â”‚     SQLite      â”‚
                          â”‚   (æŒä¹…åŒ–å­˜å‚¨)   â”‚
                          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### API ç«¯ç‚¹å®šä¹‰æ¨¡å¼

```rust
// rust-core/src/api/mod.rs

/// API ç«¯ç‚¹ trait - æ‰€æœ‰ç«¯ç‚¹çš„ç»Ÿä¸€æŠ½è±¡
pub trait ApiEndpoint: Send + Sync {
    /// è¾“å…¥ç±»å‹ï¼ˆè¯·æ±‚å‚æ•°ï¼‰
    type Input: DeserializeOwned + Send;
    /// è¾“å‡ºç±»å‹ï¼ˆå“åº”æ•°æ®ï¼‰
    type Output: Serialize + Send;
    
    /// æ‰§è¡Œç«¯ç‚¹é€»è¾‘ - çº¯å‡½æ•°ï¼Œåªä¾èµ– db å’Œ input
    fn execute(
        db: &DatabaseConnection,
        input: Self::Input,
    ) -> impl Future<Output = AppResult<Self::Output>> + Send;
}

// å…·ä½“ç«¯ç‚¹å®ç°
pub struct GetWorkspaces;
impl ApiEndpoint for GetWorkspaces {
    type Input = ();
    type Output = Vec<WorkspaceResponse>;
    
    async fn execute(db: &DatabaseConnection, _: ()) -> AppResult<Self::Output> {
        workspace_db_fn::find_all(db).await
    }
}
```

### å®ç”Ÿæˆè¾¹ç•Œä»£ç 

```rust
// rust-core/src/macros.rs

/// ç”Ÿæˆ Warp handlers
#[macro_export]
macro_rules! warp_routes {
    ($db:expr, $($endpoint:ty => $method:ident $path:literal),* $(,)?) => {{
        use warp::Filter;
        let db = std::sync::Arc::new($db);
        
        $(
            let route = warp::path!($path)
                .and(warp::$method())
                .and(with_db(db.clone()))
                .and_then(|db| async move {
                    <$endpoint>::execute(&db, ()).await
                        .map(|r| warp::reply::json(&r))
                        .map_err(|e| warp::reject::custom(e))
                });
        )*
        
        // ç»„åˆæ‰€æœ‰è·¯ç”±
        routes
    }};
}

/// ç”Ÿæˆ Tauri commands
#[macro_export]
macro_rules! tauri_commands {
    ($($endpoint:ty => $name:ident),* $(,)?) => {
        $(
            #[tauri::command]
            pub async fn $name(
                db: tauri::State<'_, DatabaseConnection>,
                input: <$endpoint as ApiEndpoint>::Input,
            ) -> Result<<$endpoint as ApiEndpoint>::Output, String> {
                <$endpoint>::execute(&db, input)
                    .await
                    .map_err(|e| e.to_string())
            }
        )*
    };
}
```

### æœ€ç»ˆä½¿ç”¨æ–¹å¼

```rust
// apps/api-rust/src/main.rs - Warp æœåŠ¡å™¨
#[tokio::main]
async fn main() {
    let db = rust_core::db::connect().await.unwrap();
    
    let routes = rust_core::warp_routes!(db,
        GetWorkspaces => get "api/workspaces",
        GetWorkspace => get "api/workspaces/{id}",
        CreateWorkspace => post "api/workspaces",
        // ... å…¶ä»–ç«¯ç‚¹
    );
    
    warp::serve(routes).run(([127, 0, 0, 1], 3030)).await;
}

// apps/desktop/src-tauri/src/lib.rs - Tauri åº”ç”¨
rust_core::tauri_commands!(
    GetWorkspaces => get_workspaces,
    GetWorkspace => get_workspace,
    CreateWorkspace => create_workspace,
    // ... å…¶ä»–ç«¯ç‚¹
);

fn main() {
    tauri::Builder::default()
        .invoke_handler(tauri::generate_handler![
            get_workspaces,
            get_workspace,
            create_workspace,
        ])
        .run(tauri::generate_context!())
        .unwrap();
}
```

### å±‚çº§èŒè´£

| å±‚çº§ | ä½ç½® | èŒè´£ |
|------|------|------|
| **api/** | `rust-core/src/api/` | API ç«¯ç‚¹å®šä¹‰ï¼Œå®ç° `ApiEndpoint` trait |
| **fn/** | `rust-core/src/fn/` | çº¯å‡½æ•°ç®¡é“ï¼Œä¸šåŠ¡é€»è¾‘è½¬æ¢ |
| **db/** | `rust-core/src/db/` | æ•°æ®åº“ CRUD æ“ä½œ |
| **types/** | `rust-core/src/types/` | ç±»å‹å®šä¹‰ï¼ˆRequest/Response/Entityï¼‰ |
| **macros/** | `rust-core/src/macros.rs` | å®å®šä¹‰ï¼Œç”Ÿæˆè¾¹ç•Œä»£ç  |

### äº‹åŠ¡æ”¯æŒ

```rust
// éœ€è¦äº‹åŠ¡çš„ç«¯ç‚¹
pub struct CreateNodeWithContent;
impl ApiEndpoint for CreateNodeWithContent {
    type Input = CreateNodeRequest;
    type Output = NodeResponse;
    
    async fn execute(db: &DatabaseConnection, input: Self::Input) -> AppResult<Self::Output> {
        // å¼€å¯äº‹åŠ¡
        let txn = db.begin().await?;
        
        // 1. åˆ›å»ºèŠ‚ç‚¹
        let node = node_db_fn::create(&txn, &input).await?;
        
        // 2. åˆ›å»ºå†…å®¹ï¼ˆå¦‚æœéœ€è¦ï¼‰
        if let Some(content) = input.initial_content {
            content_db_fn::create(&txn, &node.id, &content).await?;
        }
        
        // 3. æäº¤äº‹åŠ¡
        txn.commit().await?;
        
        Ok(node.into())
    }
}
```

### è§’è‰²å¯¹ç…§è¡¨ï¼ˆRust åç«¯ï¼‰

| æ¦‚å¿µ | è§’è‰² | ç‰¹ç‚¹ |
|-----|------|-----|
| **ApiEndpoint** | æ°´é—¸ | å®šä¹‰æ•°æ®å¦‚ä½•è¿›å‡ºç³»ç»Ÿ |
| **Input/Output** | æ°´çš„å½¢çŠ¶ | è¯·æ±‚å’Œå“åº”çš„ç±»å‹çº¦æŸ |
| **execute()** | æ°´å¤„ç†å‚ | çº¯å‡½æ•°ï¼Œå¤„ç†æ•°æ®æµ |
| **db/** | æ°´åº“ | æŒä¹…åŒ–å­˜å‚¨ |
| **fn/** | ç®¡é“ | æ•°æ®è½¬æ¢å’ŒéªŒè¯ |
| **å®** | åˆ†æµå™¨ | å°†æ°´æµå¯¼å‘ä¸åŒå‡ºå£ï¼ˆHTTP/IPCï¼‰ |
| **Warp/Tauri** | å‡ºæ°´å£ | è¾¹ç•Œé€‚é…ï¼Œä¸å«é€»è¾‘ |

---

## Rust å¼‚æ­¥æ•°æ®æµè¯¦è§£

### è®¾è®¡å“²å­¦ï¼ˆä¸å‰ç«¯å¯¹åº”ï¼‰

```
å¯¹è±¡ = çº¯æ•°æ®ï¼ˆStruct + Builder æ„å»ºï¼Œä¸å¯å˜ï¼‰
æ“ä½œ = çº¯å‡½æ•°ï¼ˆ*_fn.rs æ–‡ä»¶ï¼Œæ¥æ”¶å¯¹è±¡è¿”å›æ–°å¯¹è±¡ï¼‰
æµåŠ¨ = å¼‚æ­¥ç®¡é“ï¼ˆasync/await + Result é“¾å¼è°ƒç”¨ï¼‰
```

- **æ•°æ®æ˜¯æ°´æµ**ï¼šæ•°æ®åƒæ°´ä¸€æ ·æµç»å¼‚æ­¥ç®¡é“ï¼Œæ¯ä¸ªèŠ‚ç‚¹æ˜¯ä¸€ä¸ªçº¯å‡½æ•°
- **å¯¹è±¡æ— æ–¹æ³•**ï¼šStruct åªå®šä¹‰æ•°æ®ç»“æ„ï¼Œåªæœ‰ `new()` æˆ– Builder æ„å»ºæ–¹æ³•
- **å‡½æ•°æ˜¯ç®¡é“**ï¼šæ‰€æœ‰æ“ä½œéƒ½æ˜¯çº¯å‡½æ•°ï¼Œé€šè¿‡ `?` å’Œ `map` ç»„åˆ
- **ä¸å¯å˜æ€§**ï¼šæ•°æ®ä¸€æ—¦åˆ›å»ºå°±ä¸å¯ä¿®æ”¹ï¼Œæ›´æ–°äº§ç”Ÿæ–°å¯¹è±¡

### Rust å¼‚æ­¥æ•°æ®æµæ¶æ„å›¾

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                           Rust å¼‚æ­¥æ•°æ®æµæ¶æ„                                        â”‚
â”‚                        ï¼ˆä¸å‰ç«¯ TypeScript æ•°æ®æµå¯¹åº”ï¼‰                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

                                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                                    â”‚     å¤–éƒ¨ä¸–ç•Œ     â”‚
                                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                             â”‚
               â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
               â”‚                             â”‚                             â”‚
               â–¼                             â–¼                             â–¼
      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
      â”‚  HTTP Request   â”‚          â”‚  Tauri Invoke   â”‚          â”‚   File Import   â”‚
      â”‚   (Warp JSON)   â”‚          â”‚   (IPC JSON)    â”‚          â”‚   (æ–‡ä»¶ç³»ç»Ÿ)     â”‚
      â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚                             â”‚                             â”‚
               â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                             â”‚
                                             â–¼
                          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                          â”‚         serde Deserialize           â”‚
                          â”‚          (è¿è¡Œæ—¶ååºåˆ—åŒ–)             â”‚
                          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                             â”‚
                               â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                               â”‚                           â”‚
                          âŒ è§£æå¤±è´¥                   âœ… è§£ææˆåŠŸ
                               â”‚                           â”‚
                               â–¼                           â–¼
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚   AppError      â”‚         â”‚    Request Struct       â”‚
                    â”‚  (é”™è¯¯ç±»å‹)      â”‚         â”‚   (ä¸å¯å˜è¯·æ±‚å¯¹è±¡)        â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                                             â”‚
                                                             â–¼
                          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                          â”‚         validate_fn.rs              â”‚
                          â”‚          (æ ¡éªŒçº¯å‡½æ•°)                â”‚
                          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                             â”‚
                               â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                               â”‚                           â”‚
                          âŒ æ ¡éªŒå¤±è´¥                   âœ… æ ¡éªŒé€šè¿‡
                               â”‚                           â”‚
                               â–¼                           â–¼
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚   AppError      â”‚         â”‚   Validated Input       â”‚
                    â”‚ (ValidationErr) â”‚         â”‚   (å·²æ ¡éªŒçš„è¾“å…¥)         â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                                             â”‚
                                                             â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      Pure Function Pipeline (çº¯å‡½æ•°ç®¡é“ - fn/)                       â”‚
â”‚                                                                                    â”‚
â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚    â”‚ parse_fn.rs  â”‚â”€â”€â”€â–¶â”‚transform_fn.rsâ”‚â”€â”€â”€â–¶â”‚  tree_fn.rs  â”‚â”€â”€â”€â–¶â”‚ format_fn.rs â”‚   â”‚
â”‚    â”‚   (è§£æ)     â”‚ ?  â”‚   (è½¬æ¢)      â”‚ ?  â”‚  (æ ‘æ“ä½œ)    â”‚ ?  â”‚  (æ ¼å¼åŒ–)    â”‚   â”‚
â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                                    â”‚
â”‚    ç‰¹ç‚¹ï¼š                                                                          â”‚
â”‚    - æ‰€æœ‰å‡½æ•°éƒ½æ˜¯ async fnï¼Œè¿”å› Result<T, AppError>                               â”‚
â”‚    - ä½¿ç”¨ ? æ“ä½œç¬¦é“¾å¼ä¼ é€’é”™è¯¯                                                      â”‚
â”‚    - æ¯ä¸ªå‡½æ•°æ¥æ”¶ä¸å¯å˜å¼•ç”¨ï¼Œè¿”å›æ–°å¯¹è±¡                                              â”‚
â”‚    - æ–‡ä»¶åä»¥ _fn.rs ç»“å°¾æ ‡è¯†çº¯å‡½æ•°                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                                             â”‚
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚                                        â”‚                        â”‚
                    â–¼                                        â–¼                        â–¼
     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
     â”‚     db/*_db_fn.rs       â”‚          â”‚    Response Builder     â”‚    â”‚ Export Functions  â”‚
     â”‚      (æ•°æ®åº“æ“ä½œ)        â”‚          â”‚     (å“åº”æ„å»º)          â”‚    â”‚    (å¯¼å‡º)         â”‚
     â”‚                         â”‚          â”‚                         â”‚    â”‚                   â”‚
     â”‚  - create()             â”‚          â”‚  - into_response()      â”‚    â”‚  - to_json()      â”‚
     â”‚  - find_by_id()         â”‚          â”‚  - with_metadata()      â”‚    â”‚  - to_markdown()  â”‚
     â”‚  - update()             â”‚          â”‚                         â”‚    â”‚                   â”‚
     â”‚  - delete()             â”‚          â”‚                         â”‚    â”‚                   â”‚
     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  â”‚                                    â”‚
                  â–¼                                    â”‚
     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                       â”‚
     â”‚        SQLite           â”‚                       â”‚
     â”‚    (SeaORM å¼‚æ­¥æ“ä½œ)     â”‚                       â”‚
     â”‚                         â”‚                       â”‚
     â”‚  ~/.local/share/grain/  â”‚                       â”‚
     â”‚       grain.db          â”‚                       â”‚
     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                       â”‚
                                                       â”‚
                                                       â–¼
                          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                          â”‚         serde Serialize             â”‚
                          â”‚          (åºåˆ—åŒ–ä¸º JSON)             â”‚
                          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                             â”‚
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚                        â”‚                        â”‚
                    â–¼                        â–¼                        â–¼
           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
           â”‚  HTTP Responseâ”‚        â”‚ Tauri Responseâ”‚        â”‚  File Output  â”‚
           â”‚  (Warp JSON)  â”‚        â”‚  (IPC JSON)   â”‚        â”‚   (æ–‡ä»¶ç³»ç»Ÿ)   â”‚
           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â”‚                        â”‚                        â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                             â”‚
                                             â–¼
                                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                                    â”‚     å‰ç«¯æ¥æ”¶     â”‚
                                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Rust ä¾èµ–å…³ç³»å›¾

```
                              types/
                    (Struct + Builder + Request/Response)
                                 â”‚
                                 â”‚ è¢«æ‰€æœ‰å±‚ä¾èµ–
                                 â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚                        â”‚                        â”‚
        â–¼                        â–¼                        â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ error  â”‚              â”‚  db/   â”‚              â”‚ macros/â”‚
    â”‚(AppErr)â”‚              â”‚(æŒä¹…åŒ–) â”‚              â”‚ (å®)   â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚                        â”‚                        â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                 â”‚
                                 â–¼
                          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                          â”‚    fn/     â”‚
                          â”‚ (*_fn.rs)  â”‚
                          â”‚  (çº¯å‡½æ•°)   â”‚
                          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                 â”‚
                                 â–¼
                          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                          â”‚   api/     â”‚
                          â”‚(ApiEndpointâ”‚
                          â”‚   trait)   â”‚
                          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                 â”‚
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚                         â”‚
                    â–¼                         â–¼
             â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
             â”‚ Warp Serverâ”‚            â”‚   Tauri    â”‚
             â”‚ (api-rust) â”‚            â”‚ (desktop)  â”‚
             â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Rust ä¾èµ–è§„åˆ™

| å±‚çº§ | å¯ä¾èµ– | è¯´æ˜ |
|------|--------|------|
| `types/` | æ—  | æœ€åº•å±‚ï¼Œçº¯æ•°æ®å®šä¹‰ |
| `types/error.rs` | `types/` | é”™è¯¯ç±»å‹å®šä¹‰ |
| `db/` | `types/` | æ•°æ®åº“æ“ä½œï¼ˆå‰¯ä½œç”¨è¾¹ç•Œï¼‰ |
| `fn/` | `types/` | çº¯å‡½æ•°ç®¡é“ï¼ˆæ— å‰¯ä½œç”¨ï¼‰ |
| `api/` | `types/`, `fn/`, `db/` | API ç«¯ç‚¹å®šä¹‰ |
| `macros/` | `api/` | å®ç”Ÿæˆè¾¹ç•Œä»£ç  |
| `Warp/Tauri` | `macros/`, `api/` | è¾¹ç•Œé€‚é…å™¨ |

### æ•°æ®ä¸‰å±‚å®ˆå«ï¼ˆRust ç‰ˆï¼‰

| å±‚çº§ | èŒè´£ | æ—¶æœº | å¯¹åº”å‰ç«¯ |
|------|------|------|---------|
| **serde** | è¿è¡Œæ—¶ååºåˆ—åŒ– | æ•°æ®å…¥å£ | Zod Schema |
| **Struct** | ç¼–è¯‘æ—¶ç±»å‹æ£€æŸ¥ | å¼€å‘æ—¶ | Interface |
| **Builder** | æ„å»ºçº¦æŸ + ä¸å¯å˜ | å¯¹è±¡åˆ›å»º | Builder |

### å‰åç«¯æ•°æ®æµå¯¹ç…§

| å‰ç«¯ (TypeScript) | åç«¯ (Rust) | è¯´æ˜ |
|------------------|-------------|------|
| `Zod Schema` | `serde Deserialize` | è¿è¡Œæ—¶æ•°æ®æ ¡éªŒ |
| `Interface` | `Struct` | ç¼–è¯‘æ—¶ç±»å‹å®šä¹‰ |
| `Builder` | `Builder` / `new()` | å¯¹è±¡æ„å»º |
| `*.fn.ts` | `*_fn.rs` | çº¯å‡½æ•°æ–‡ä»¶ |
| `pipe()` | `?` + `map()` | å‡½æ•°ç»„åˆ |
| `TaskEither` | `Result<T, AppError>` | é”™è¯¯å¤„ç† |
| `IndexedDB` | `SQLite` | æŒä¹…åŒ–å­˜å‚¨ |
| `Zustand Store` | (æ— å¯¹åº”) | å‰ç«¯çŠ¶æ€ç®¡ç† |
| `React Hooks` | (æ— å¯¹åº”) | å‰ç«¯å“åº”å¼ç»‘å®š |

### å¼‚æ­¥å‡½æ•°ç­¾åè§„èŒƒ

```rust
// çº¯å‡½æ•°ç­¾åï¼ˆfn/*_fn.rsï¼‰
// ç‰¹ç‚¹ï¼šæ— å‰¯ä½œç”¨ï¼Œåªä¾èµ–è¾“å…¥å‚æ•°
pub fn validate_node(input: &CreateNodeRequest) -> Result<ValidatedNode, AppError> {
    // çº¯è®¡ç®—ï¼Œæ—  IO
}

pub fn transform_node(node: &Node, update: &UpdateNodeRequest) -> Node {
    // è¿”å›æ–°å¯¹è±¡ï¼Œä¸ä¿®æ”¹åŸå¯¹è±¡
    Node {
        id: node.id.clone(),
        title: update.title.clone().unwrap_or_else(|| node.title.clone()),
        // ...
    }
}

// æ•°æ®åº“å‡½æ•°ç­¾åï¼ˆdb/*_db_fn.rsï¼‰
// ç‰¹ç‚¹ï¼šæœ‰å‰¯ä½œç”¨ï¼ˆIOï¼‰ï¼Œasync
pub async fn create_node(
    db: &DatabaseConnection,
    input: &CreateNodeRequest,
) -> Result<Node, AppError> {
    // æ•°æ®åº“æ“ä½œ
}

pub async fn find_by_id(
    db: &DatabaseConnection,
    id: &str,
) -> Result<Option<Node>, AppError> {
    // æ•°æ®åº“æŸ¥è¯¢
}

// API ç«¯ç‚¹ç­¾åï¼ˆapi/*.rsï¼‰
// ç‰¹ç‚¹ï¼šç»„åˆçº¯å‡½æ•°å’Œæ•°æ®åº“å‡½æ•°
impl ApiEndpoint for CreateNode {
    type Input = CreateNodeRequest;
    type Output = NodeResponse;
    
    async fn execute(db: &DatabaseConnection, input: Self::Input) -> AppResult<Self::Output> {
        // 1. æ ¡éªŒï¼ˆçº¯å‡½æ•°ï¼‰
        let validated = validate_fn::validate_node(&input)?;
        
        // 2. è½¬æ¢ï¼ˆçº¯å‡½æ•°ï¼‰
        let node_data = transform_fn::to_node_entity(&validated);
        
        // 3. æŒä¹…åŒ–ï¼ˆå‰¯ä½œç”¨ï¼‰
        let node = node_db_fn::create(db, &node_data).await?;
        
        // 4. æ„å»ºå“åº”ï¼ˆçº¯å‡½æ•°ï¼‰
        Ok(NodeResponse::from(node))
    }
}
```

### è§’è‰²å¯¹ç…§è¡¨ï¼ˆå‰åç«¯ç»Ÿä¸€ï¼‰

| æ¦‚å¿µ | å‰ç«¯è§’è‰² | åç«¯è§’è‰² | ç‰¹ç‚¹ |
|-----|---------|---------|-----|
| **æ•°æ®å½¢çŠ¶** | Interface | Struct | å®šä¹‰æ•°æ®é•¿ä»€ä¹ˆæ · |
| **æ„å»ºå™¨** | Builder | Builder/new() | æ„å»ºç¬¦åˆå½¢çŠ¶çš„æ•°æ® |
| **å®ˆé—¨å‘˜** | Zod Schema | serde | è¿è¡Œæ—¶æ ¡éªŒæ•°æ®æœ‰æ•ˆæ€§ |
| **ç®¡é“** | Function (*.fn.ts) | Function (*_fn.rs) | çº¯å‡€ã€æ— å‰¯ä½œç”¨ã€å¯ç»„åˆ |
| **è¿æ¥å™¨** | pipe() | ? + map() | è®©æ•°æ®æµåŠ¨èµ·æ¥ |
| **æ°´åº“** | IndexedDB | SQLite | æŒä¹…åŒ–å­˜å‚¨ |
| **é”™è¯¯å®¹å™¨** | TaskEither | Result<T, E> | é”™è¯¯ä¼ é€’ |
| **è¾¹ç•Œ** | API Client | Warp/Tauri | æ•°æ®å…¥å£å’Œå‡ºå£ |

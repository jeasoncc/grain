# ğŸ” Tauri æ„å»ºé”™è¯¯åˆ†æ

## âŒ é”™è¯¯ä¿¡æ¯

```
failed to read plugin permissions: failed to read file 
'/home/lotus/project/book2/novel-editor/src-tauri/target/release/build/tauri-a5507509c69cbb1b/out/permissions/app/autogenerated/commands/app_hide.toml': 
No such file or directory (os error 2)
```

## ğŸ” é—®é¢˜åˆ†æ

### é”™è¯¯è·¯å¾„

**æœŸæœ›çš„è·¯å¾„**: `/home/lotus/project/book2/novel-editor/src-tauri/...`
**å®é™…è·¯å¾„**: `/home/lotus/project/book2/novel-editor/apps/desktop/src-tauri/...`

### æ ¹æœ¬åŸå› 

Tauri æ„å»ºè„šæœ¬åœ¨å¯»æ‰¾ `src-tauri` ç›®å½•æ—¶ï¼Œä½¿ç”¨äº†**é”™è¯¯çš„ç›¸å¯¹è·¯å¾„**ã€‚

**é—®é¢˜æ‰€åœ¨**:
1. å½“å‰å·¥ä½œç›®å½•: `/home/lotus/project/book2/novel-editor/apps/desktop/`
2. Tauri æŸ¥æ‰¾è·¯å¾„: `../../src-tauri/` (å‘ä¸Šä¸¤çº§)
3. å®é™…è·¯å¾„: `./src-tauri/` (å½“å‰ç›®å½•ä¸‹)

### ä¸ºä»€ä¹ˆä¼šè¿™æ ·ï¼Ÿ

åœ¨ monorepo è¿ç§»åï¼š
- **æ—§ç»“æ„**: `novel-editor/src-tauri/`
- **æ–°ç»“æ„**: `novel-editor/apps/desktop/src-tauri/`

Tauri æ„å»ºæ—¶ï¼ŒæŸäº›è·¯å¾„è®¡ç®—ä»ç„¶åŸºäºæ—§çš„é¡¹ç›®ç»“æ„ã€‚

## ğŸ”§ è§£å†³æ–¹æ¡ˆ

### æ–¹æ¡ˆ 1: åœ¨æ ¹ç›®å½•è¿è¡Œæ„å»ºï¼ˆæ¨èï¼‰

ä¸è¦åœ¨ `apps/desktop` ç›®å½•ä¸­è¿è¡Œ `bun tauri build`ï¼Œè€Œæ˜¯åœ¨æ ¹ç›®å½•è¿è¡Œï¼š

```bash
# âŒ é”™è¯¯æ–¹å¼
cd apps/desktop
bun tauri build

# âœ… æ­£ç¡®æ–¹å¼
cd /home/lotus/project/book2/novel-editor
bun run build --filter=desktop
cd apps/desktop
bun tauri build
```

### æ–¹æ¡ˆ 2: ä½¿ç”¨ Turborepo æ„å»ºè„šæœ¬

åˆ›å»ºä¸€ä¸ªä¸“é—¨çš„æ„å»ºè„šæœ¬ï¼š

```json
// apps/desktop/package.json
{
  "scripts": {
    "tauri:build": "tauri build"
  }
}
```

ç„¶ååœ¨æ ¹ç›®å½•è¿è¡Œï¼š
```bash
bun turbo run tauri:build --filter=desktop
```

### æ–¹æ¡ˆ 3: ä¿®å¤ Cargo é…ç½®

æ£€æŸ¥ `~/.cargo/config` æˆ– `apps/desktop/src-tauri/.cargo/config`ï¼š

```bash
# æ£€æŸ¥æ˜¯å¦æœ‰æ—§çš„è·¯å¾„é…ç½®
cat ~/.cargo/config
cat apps/desktop/src-tauri/.cargo/config
```

## ğŸ¯ ç«‹å³ä¿®å¤

### æ­¥éª¤ 1: æ¸…ç†æ„å»ºç¼“å­˜

```bash
# æ¸…ç† Rust æ„å»ºç¼“å­˜
cd apps/desktop/src-tauri
cargo clean

# æ¸…ç†å‰ç«¯æ„å»º
cd ../..
rm -rf dist
```

### æ­¥éª¤ 2: é‡æ–°æ„å»º

```bash
# åœ¨ apps/desktop ç›®å½•
cd apps/desktop

# å®‰è£…ä¾èµ–
bun install

# æ„å»ºå‰ç«¯
bun run build

# æ„å»º Tauriï¼ˆä½¿ç”¨å®Œæ•´è·¯å¾„ï¼‰
bun tauri build
```

### æ­¥éª¤ 3: å¦‚æœè¿˜æ˜¯å¤±è´¥

å°è¯•ä½¿ç”¨ç»å¯¹è·¯å¾„ï¼š

```bash
cd /home/lotus/project/book2/novel-editor/apps/desktop
bun tauri build
```

## ğŸ“‹ æ£€æŸ¥æ¸…å•

### 1. æ£€æŸ¥ç›®å½•ç»“æ„

```bash
# ç¡®è®¤ src-tauri åœ¨æ­£ç¡®ä½ç½®
ls -la apps/desktop/src-tauri/

# åº”è¯¥çœ‹åˆ°:
# - Cargo.toml
# - tauri.conf.json
# - src/
```

### 2. æ£€æŸ¥ Cargo é…ç½®

```bash
# æ£€æŸ¥æ˜¯å¦æœ‰æ—§çš„é…ç½®
cat ~/.cargo/config 2>/dev/null || echo "No global cargo config"
cat apps/desktop/src-tauri/.cargo/config 2>/dev/null || echo "No local cargo config"
```

### 3. æ£€æŸ¥ Tauri é…ç½®

```bash
# ç¡®è®¤ tauri.conf.json è·¯å¾„æ­£ç¡®
cat apps/desktop/src-tauri/tauri.conf.json | grep frontendDist
# åº”è¯¥æ˜¾ç¤º: "frontendDist": "../dist"
```

## ğŸ” æ·±å…¥åˆ†æ

### Cargo é…ç½®è­¦å‘Š

```
warning: `/home/lotus/.cargo/config` is deprecated in favor of `config.toml`
```

**è§£å†³**:
```bash
# å¦‚æœå­˜åœ¨æ—§é…ç½®ï¼Œé‡å‘½åå®ƒ
if [ -f ~/.cargo/config ]; then
    mv ~/.cargo/config ~/.cargo/config.toml
fi
```

### è·¯å¾„é—®é¢˜çš„æ ¹æº

Tauri æ„å»ºè„šæœ¬ä¸­çš„è·¯å¾„è®¡ç®—ï¼š

```rust
// ä¼ªä»£ç ç¤ºä¾‹
let project_root = env::current_dir()?; // apps/desktop
let tauri_dir = project_root.join("src-tauri"); // apps/desktop/src-tauri âœ…
let permissions_dir = project_root.parent()?.join("src-tauri"); // novel-editor/src-tauri âŒ
```

**é—®é¢˜**: æŸäº›è·¯å¾„è®¡ç®—å‘ä¸ŠæŸ¥æ‰¾äº†çˆ¶ç›®å½•ã€‚

## ğŸ› ï¸ å®Œæ•´çš„ä¿®å¤è„šæœ¬

åˆ›å»º `scripts/build-desktop.sh`:

```bash
#!/bin/bash

set -e

echo "ğŸ”¨ Building Novel Editor Desktop App"
echo ""

# è¿›å…¥é¡¹ç›®æ ¹ç›®å½•
cd "$(dirname "$0")/.."

# æ¸…ç†æ—§çš„æ„å»º
echo "ğŸ§¹ Cleaning old builds..."
rm -rf apps/desktop/dist
rm -rf apps/desktop/src-tauri/target/release/bundle

# è¿›å…¥æ¡Œé¢åº”ç”¨ç›®å½•
cd apps/desktop

# å®‰è£…ä¾èµ–
echo "ğŸ“¦ Installing dependencies..."
bun install

# æ„å»ºå‰ç«¯
echo "ğŸ¨ Building frontend..."
bun run build

# æ£€æŸ¥å‰ç«¯æ„å»ºç»“æœ
if [ ! -d "dist" ]; then
    echo "âŒ Frontend build failed: dist directory not found"
    exit 1
fi

echo "âœ… Frontend built successfully"

# æ„å»º Tauri
echo "ğŸ¦€ Building Tauri app..."
bun tauri build

echo ""
echo "âœ… Build complete!"
echo "ğŸ“¦ Bundles are in: src-tauri/target/release/bundle/"
```

ä½¿ç”¨æ–¹æ³•ï¼š
```bash
chmod +x scripts/build-desktop.sh
./scripts/build-desktop.sh
```

## ğŸ¯ GitHub Actions ä¿®å¤

æ›´æ–° `.github/workflows/release-desktop.yml`:

```yaml
# æ„å»ºæ¡Œé¢åº”ç”¨å‰ç«¯
- name: Build frontend
  working-directory: apps/desktop
  run: |
    bun install
    bun run build
    
# éªŒè¯æ„å»ºç»“æœ
- name: Verify frontend build
  working-directory: apps/desktop
  run: |
    if [ ! -d "dist" ]; then
      echo "Frontend build failed"
      exit 1
    fi
    echo "Frontend build successful"
    ls -la dist/

# æ„å»º & å‘å¸ƒ Tauri App
- uses: tauri-apps/tauri-action@v0
  env:
    GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
  with:
    projectPath: apps/desktop
    tagName: desktop-v__VERSION__
    releaseName: 'Novel Editor Desktop v__VERSION__'
    releaseBody: 'See the assets to download this version and install.'
    releaseDraft: true
    prerelease: false
    args: ${{ matrix.args }}
```

## ğŸ“Š å¯¹æ¯”ï¼šå·¥ä½œæµä¾èµ–å®‰è£…

### å½“å‰æ–¹å¼ï¼ˆå¯èƒ½æœ‰é—®é¢˜ï¼‰

```yaml
- name: Install dependencies
  working-directory: apps/desktop
  run: bun install
```

**é—®é¢˜**: åªåœ¨å­ç›®å½•å®‰è£…ä¾èµ–ï¼Œå¯èƒ½ç¼ºå°‘ monorepo çš„ä¾èµ–ã€‚

### æ¨èæ–¹å¼

```yaml
# æ–¹å¼ 1: åœ¨æ ¹ç›®å½•å®‰è£…æ‰€æœ‰ä¾èµ–
- name: Install dependencies
  run: bun install

# æ–¹å¼ 2: å…ˆæ ¹ç›®å½•ï¼Œå†å­ç›®å½•
- name: Install root dependencies
  run: bun install

- name: Install desktop dependencies
  working-directory: apps/desktop
  run: bun install
```

## âœ… éªŒè¯æ­¥éª¤

### 1. æœ¬åœ°æµ‹è¯•

```bash
# æ¸…ç†
cd apps/desktop
cargo clean
rm -rf dist

# æ„å»º
bun install
bun run build
bun tauri build

# æ£€æŸ¥ç»“æœ
ls -la src-tauri/target/release/bundle/
```

### 2. æ£€æŸ¥æ„å»ºäº§ç‰©

```bash
# åº”è¯¥çœ‹åˆ°:
# - deb/
# - rpm/
# - appimage/
```

## ğŸŠ æ€»ç»“

**é—®é¢˜**: Tauri æ„å»ºæ—¶è·¯å¾„è®¡ç®—é”™è¯¯ï¼ŒæŸ¥æ‰¾äº†é”™è¯¯çš„ `src-tauri` ä½ç½®

**åŸå› **: Monorepo è¿ç§»åï¼ŒæŸäº›è·¯å¾„è®¡ç®—ä»åŸºäºæ—§ç»“æ„

**è§£å†³æ–¹æ¡ˆ**:
1. âœ… æ¸…ç†æ„å»ºç¼“å­˜
2. âœ… åœ¨æ­£ç¡®çš„ç›®å½•è¿è¡Œæ„å»º
3. âœ… ä½¿ç”¨æ„å»ºè„šæœ¬ç¡®ä¿è·¯å¾„æ­£ç¡®
4. âœ… æ›´æ–° GitHub Actions å·¥ä½œæµ

**ä¸‹ä¸€æ­¥**:
1. æ¸…ç†æ„å»ºç¼“å­˜
2. é‡æ–°æ„å»º
3. æµ‹è¯•æœ¬åœ°æ„å»º
4. æ›´æ–° GitHub Actions

---

**ä¿®å¤ååº”è¯¥å¯ä»¥æ­£å¸¸æ„å»ºäº†ï¼** ğŸš€

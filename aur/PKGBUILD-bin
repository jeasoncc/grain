# Maintainer: Jeason <xiaomiquan@aliyun.com>

pkgname=grain-bin
pkgver=0.1.91
pkgrel=1
pkgdesc="A minimalist writing sanctuary for long-form content (binary)"
arch=('x86_64')
url="https://github.com/jeasoncc/grain"
license=('MIT')
depends=(
  'webkit2gtk'
  'gtk3'
  'libappindicator-gtk3'
)
provides=('grain')
conflicts=('grain')
source=(
  "$pkgname-$pkgver.deb::https://github.com/jeasoncc/grain/releases/download/desktop-v$pkgver/grain_${pkgver}_amd64.deb"
)
sha256sums=('SKIP')

prepare() {
  # Extract DEB package
  cd "$srcdir"
  ar x "$pkgname-$pkgver.deb"
  
  # Check data file format and extract
  if [ -f data.tar.xz ]; then
    tar -xf data.tar.xz
  elif [ -f data.tar.gz ]; then
    tar -xf data.tar.gz
  elif [ -f data.tar.zst ]; then
    tar -xf data.tar.zst
  else
    echo "Error: No supported data archive found"
    exit 1
  fi
}

package() {
  cd "$srcdir"
  
  # Copy all files to target directory
  cp -r usr "$pkgdir/"
  
  # Ensure binary has execute permission
  chmod +x "$pkgdir/usr/bin/grain"
}